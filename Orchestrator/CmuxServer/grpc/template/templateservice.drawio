<mxfile host="Electron" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/29.0.3 Chrome/140.0.7339.249 Electron/38.7.0 Safari/537.36" version="29.0.3" pages="14">
  <diagram name="1.TemplateCreate" id="mDl5Sa2fqAszxTJ_AcBv">
    <mxGraphModel dx="1907" dy="1159" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-1" value="开始 TemplateCreate" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="326" y="20" width="175" height="34" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-2" value="设置追踪&#xa;tracer.Start(&#39;template-create&#39;)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="297" y="104" width="232" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-3" value="设置追踪属性&#xa;childSpan.SetAttributes()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="315" y="203" width="196" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-4" value="检查服务器状态&#xa;s.info.GetStatus() != orchestrator.ServiceInfoStatus_Healthy" style="rhombus;strokeWidth=2;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="317" y="303" width="192" height="187" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-5" value="返回错误&#xa;&#39;server is draining&#39;" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="20" y="1580" width="143" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-6" value="创建元数据&#xa;storage.TemplateFiles{}" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="444" y="564" width="185" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-7" value="获取缓存作用域&#xa;默认为 templateID" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="463" y="663" width="148" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-8" value="创建认证提供者&#xa;auth.NewAuthProvider()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="443" y="763" width="188" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-9" value="确定模板版本&#xa;templateRequest.GetVersion()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="420" y="862" width="233" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-10" value="创建模板配置&#xa;config.TemplateConfig{}" style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="443" y="962" width="188" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-11" value="创建日志记录器&#xa;buildlogger.NewLogEntryLogger()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="411" y="1080" width="252" height="50" as="geometry" />
        </mxCell>
        <object label="创建构建缓存&#xa;buildInfo = s.buildCache.Create()" id="66">
          <mxCell style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
            <mxGeometry x="451" y="1180" width="172" height="50" as="geometry" />
          </mxCell>
        </object>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-13" value="返回错误&#xa;&#39;error while creating build cache&#39;" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="213" y="1580" width="250" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-14" value="创建 Zap 核心&#xa;zapcore.NewTee()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="580" y="1298" width="145" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-15" value="增加等待组&#xa;s.wg.Add(1)" style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="602" y="1397" width="101" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-16" value="启动后台构建 goroutine" style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="560" y="1497" width="184" height="34" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-17" value="立即返回&#xa;return nil, nil" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="514" y="1580" width="112" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-18" value="结束主流程" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="287" y="1688" width="104" height="34" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-19" value="后台构建开始" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="675" y="1588" width="120" height="34" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-20" value="设置 defer&#xa;defer s.wg.Done()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="663" y="1680" width="144" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-21" value="创建构建上下文&#xa;context.WithCancel()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="651" y="1780" width="168" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-22" value="设置构建追踪&#xa;tracer.Start(&#39;template-background-build&#39;)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="580" y="1879" width="310" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-23" value="设置 panic 恢复&#xa;defer recover()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="671" y="1979" width="127" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-24" value="启动取消监听 goroutine&#xa;go watch buildInfo.Result.Done" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="615" y="2078" width="239" height="50" as="geometry" />
        </mxCell>
        <UserObject label="执行构建&#xa;s.builder.Build()" link="data:page/id,Si-DR3fJ-AE2JFd4cjZ9" id="fZ5MmAq4PVk6pfhPcHnG-25">
          <mxCell style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
            <mxGeometry x="489" y="2178" width="130" height="50" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-26" value="同步日志核心&#xa;core.Sync()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="498" y="2277" width="111" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-27" value="构建结果" style="rhombus;strokeWidth=2;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="497" y="2412" width="113" height="113" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-28" value="上报构建错误&#xa;telemetry.ReportCriticalError()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="308" y="2609" width="237" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-29" value="设置失败状态&#xa;buildInfo.SetFail()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="354" y="2708" width="145" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-30" value="设置成功状态&#xa;buildInfo.SetSuccess()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="595" y="2609" width="173" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-31" value="上报成功事件&#xa;telemetry.ReportEvent()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="587" y="2708" width="189" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-32" value="后台构建结束" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="494" y="2808" width="120" height="34" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-33" value="取消监听开始" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="887" y="2186" width="120" height="34" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-34" value="等待信号&#xa;select ctx.Done or buildInfo.Done" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="818" y="2277" width="256" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-35" value="返回" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="826" y="2716" width="47" height="34" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-36" value="检查构建状态" style="rhombus;strokeWidth=2;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="928" y="2396" width="145" height="145" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-37" value="取消构建&#xa;cancel()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="912" y="2609" width="79" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-38" value="返回" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1025" y="2716" width="47" height="34" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-39" value="返回" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="928" y="2716" width="47" height="34" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-40" value="取消监听结束" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="887" y="2808" width="120" height="34" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-41" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4985672542027065;exitY=0.9873950060676125;entryX=0.5010744374373863;entryY=-0.008571395874023438;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-1" target="fZ5MmAq4PVk6pfhPcHnG-2" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-42" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5010744374373863;exitY=0.9828572082519531;entryX=0.5012717830891512;entryY=0.002857208251953125;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-2" target="fZ5MmAq4PVk6pfhPcHnG-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-43" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5012717830891512;exitY=0.9942858123779297;entryX=0.5012982785701752;entryY=-0.0014880696932474773;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-3" target="fZ5MmAq4PVk6pfhPcHnG-4" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-44" value="不健康" style="curved=1;startArrow=none;endArrow=block;exitX=0.0007247229417165121;exitY=0.7019978382431056;entryX=0.500489134888549;entryY=0.0072625732421875;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-4" target="fZ5MmAq4PVk6pfhPcHnG-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="92" y="529" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-45" value="健康" style="curved=1;startArrow=none;endArrow=block;exitX=0.9750311156744544;exitY=0.9996590415636698;entryX=0.5008286037960568;entryY=-0.00988067626953125;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-4" target="fZ5MmAq4PVk6pfhPcHnG-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="537" y="529" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-46" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5008286037960568;exitY=0.9815479278564453;entryX=0.4976573763666926;entryY=0.0015479278564453124;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-6" target="fZ5MmAq4PVk6pfhPcHnG-7" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-47" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4976573763666926;exitY=0.9929765319824219;entryX=0.4981558069269708;entryY=-0.007023468017578125;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-7" target="fZ5MmAq4PVk6pfhPcHnG-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-48" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4981558069269708;exitY=0.9844051361083984;entryX=0.5006579043015902;entryY=0.004405136108398437;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-8" target="fZ5MmAq4PVk6pfhPcHnG-9" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-49" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5006579043015902;exitY=0.995833740234375;entryX=0.4981558069269708;entryY=-0.004166259765625;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-9" target="fZ5MmAq4PVk6pfhPcHnG-10" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-50" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4981558069269708;exitY=0.9872623443603515;entryX=0.49862417342170834;entryY=-0.001309051513671875;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-10" target="fZ5MmAq4PVk6pfhPcHnG-11" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-51" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49862417342170834;exitY=0.9901195526123047;entryX=0.4979842540829681;entryY=-0.009880447387695312;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-11" target="66" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-52" value="失败" style="curved=1;startArrow=none;endArrow=block;exitX=0.014297562167352488;exitY=0.9815481567382812;entryX=0.501511962890625;entryY=0.0072625732421875;rounded=0;" parent="1" source="66" target="fZ5MmAq4PVk6pfhPcHnG-13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="338" y="1263" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-53" value="成功" style="curved=1;startArrow=none;endArrow=block;exitX=0.7797485176072585;exitY=0.9815481567382812;entryX=0.49762432493012526;entryY=-0.007023239135742187;rounded=0;" parent="1" source="66" target="fZ5MmAq4PVk6pfhPcHnG-14" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="652" y="1263" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-54" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49762432493012526;exitY=0.9844053649902343;entryX=0.4965893773749323;entryY=0.004405364990234375;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-14" target="fZ5MmAq4PVk6pfhPcHnG-15" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-55" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4965893773749323;exitY=0.9958339691162109;entryX=0.5008452560590662;entryY=-0.006126516005572151;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-15" target="fZ5MmAq4PVk6pfhPcHnG-16" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-56" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.3201348233668778;exitY=0.9812684900620404;entryX=0.49448626382010324;entryY=0.0072625732421875;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-16" target="fZ5MmAq4PVk6pfhPcHnG-17" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="569" y="1555" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-57" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49448626382010324;exitY=0.998691177368164;entryX=0.9919243592482346;entryY=0.1635373288765603;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-17" target="fZ5MmAq4PVk6pfhPcHnG-18" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="569" y="1655" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-58" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.500489134888549;exitY=0.998691177368164;entryX=-0.0038860761202298678;entryY=0.1845548482596822;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-5" target="fZ5MmAq4PVk6pfhPcHnG-18" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="92" y="1655" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-59" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.501511962890625;exitY=0.998691177368164;entryX=0.4940191415640024;entryY=-0.001924739164464614;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-13" target="fZ5MmAq4PVk6pfhPcHnG-18" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-60" value="" style="curved=1;dashed=1;dashPattern=2 3;startArrow=none;endArrow=block;exitX=0.6815556887512544;exitY=0.9812684900620404;entryX=0.4994049390157064;entryY=0.010680254767922795;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-16" target="fZ5MmAq4PVk6pfhPcHnG-19" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="735" y="1555" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-61" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4994049390157064;exitY=0.9980752608355354;entryX=0.49950411584642196;entryY=-0.0013088226318359376;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-19" target="fZ5MmAq4PVk6pfhPcHnG-20" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-62" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49950411584642196;exitY=0.9901197814941406;entryX=0.4995749564397903;entryY=-0.009880218505859375;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-20" target="fZ5MmAq4PVk6pfhPcHnG-21" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-63" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4995749564397903;exitY=0.9815483856201171;entryX=0.4997696538125315;entryY=0.0015483856201171874;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-21" target="fZ5MmAq4PVk6pfhPcHnG-22" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-64" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4997696538125315;exitY=0.9929769897460937;entryX=0.5033747455266517;entryY=-0.00702301025390625;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-22" target="fZ5MmAq4PVk6pfhPcHnG-23" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-65" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5033747455266517;exitY=0.9844055938720703;entryX=0.5017932748196016;entryY=0.004405593872070313;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-23" target="fZ5MmAq4PVk6pfhPcHnG-24" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-66" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.12463644909474998;exitY=0.9958341979980468;entryX=0.4989870805006761;entryY=-0.004165802001953125;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-24" target="fZ5MmAq4PVk6pfhPcHnG-25" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="554" y="2153" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-67" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4989870805006761;exitY=0.9872628021240234;entryX=0.5033182023881791;entryY=0.007262802124023438;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-25" target="fZ5MmAq4PVk6pfhPcHnG-26" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-68" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5033182023881791;exitY=0.99869140625;entryX=0.5032594731423707;entryY=-0.0044138410450082965;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-26" target="fZ5MmAq4PVk6pfhPcHnG-27" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-69" value="失败" style="curved=1;startArrow=none;endArrow=block;exitX=0.0043761666897123895;exitY=0.9117771336742907;entryX=0.49942868067745416;entryY=-0.003689422607421875;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-27" target="fZ5MmAq4PVk6pfhPcHnG-28" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="426" y="2575" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-70" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49942868067745416;exitY=0.9877391815185547;entryX=0.499066188417632;entryY=0.007739181518554687;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-28" target="fZ5MmAq4PVk6pfhPcHnG-29" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-71" value="成功" style="curved=1;startArrow=none;endArrow=block;exitX=1.002142779595029;exitY=0.9117771336742907;entryX=0.4992603676856598;entryY=-0.003689422607421875;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-27" target="fZ5MmAq4PVk6pfhPcHnG-30" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="681" y="2575" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-72" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4992603676856598;exitY=0.9877391815185547;entryX=0.49932298206147696;entryY=0.007739181518554687;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-30" target="fZ5MmAq4PVk6pfhPcHnG-31" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-73" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.499066188417632;exitY=0.9991677856445312;entryX=0.07207395527218381;entryY=-0.0012238446403952205;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-29" target="fZ5MmAq4PVk6pfhPcHnG-32" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="426" y="2783" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-74" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49932298206147696;exitY=0.9991677856445312;entryX=0.9257313858126148;entryY=-0.0012238446403952205;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-31" target="fZ5MmAq4PVk6pfhPcHnG-32" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="681" y="2783" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-75" value="" style="curved=1;dashed=1;dashPattern=2 3;startArrow=none;endArrow=block;exitX=0.9425031466440272;exitY=0.9958341979980468;entryX=0.49582115809122723;entryY=-0.006126179414636949;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-24" target="fZ5MmAq4PVk6pfhPcHnG-33" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="946" y="2153" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-76" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49582115809122723;exitY=0.9812688266529757;entryX=0.5019474178552628;entryY=0.007262802124023438;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-33" target="fZ5MmAq4PVk6pfhPcHnG-34" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-77" value="ctx.Done" style="curved=1;startArrow=none;endArrow=block;exitX=0.3429723233561779;exitY=0.99869140625;entryX=0.5000955297591838;entryY=0.011381149291992188;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-34" target="fZ5MmAq4PVk6pfhPcHnG-35" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="850" y="2361" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-78" value="buildInfo.Done" style="curved=1;startArrow=none;endArrow=block;exitX=0.5899373764444902;exitY=0.99869140625;entryX=0.4978142310833109;entryY=-0.0034068929738011854;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-34" target="fZ5MmAq4PVk6pfhPcHnG-36" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1000" y="2361" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-79" value="Failed" style="curved=1;startArrow=none;endArrow=block;exitX=0.27086971233799634;exitY=0.9947868873333109;entryX=0.5023549236828768;entryY=-0.003689422607421875;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-36" target="fZ5MmAq4PVk6pfhPcHnG-37" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="952" y="2575" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-80" value="其他" style="curved=1;startArrow=none;endArrow=block;exitX=0.7247587498286254;exitY=0.9947868873333109;entryX=0.5038316604938913;entryY=0.011381149291992188;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-36" target="fZ5MmAq4PVk6pfhPcHnG-38" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1049" y="2575" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-81" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5023549236828768;exitY=0.9877391815185547;entryX=0.5039582759776013;entryY=0.011381149291992188;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-37" target="fZ5MmAq4PVk6pfhPcHnG-39" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-82" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5000955297591838;exitY=0.9987761553596047;entryX=0.1711259701127337;entryY=-0.0012238446403952205;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-35" target="fZ5MmAq4PVk6pfhPcHnG-40" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="850" y="2783" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-83" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5038316604938913;exitY=0.9987761553596047;entryX=0.8378819092537413;entryY=-0.0012238446403952205;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-38" target="fZ5MmAq4PVk6pfhPcHnG-40" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1049" y="2783" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-84" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5039582759776013;exitY=0.9987761553596047;entryX=0.5131867212752478;entryY=-0.0012238446403952205;rounded=0;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-39" target="fZ5MmAq4PVk6pfhPcHnG-40" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="952" y="2783" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-85" value="&lt;div style=&quot;color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;BuildID&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;cfg&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #aa3731;font-weight: bold;&quot;&gt;GetBuildID&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;(), //&amp;nbsp;&lt;/span&gt;是这&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; background-color: rgb(242, 242, 242);&quot;&gt;次&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; background-color: rgb(242, 242, 242);&quot;&gt;模&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; background-color: rgb(242, 242, 242);&quot;&gt;板构&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; background-color: rgb(242, 242, 242);&quot;&gt;建的唯一标识符&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #333333;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;KernelVersion&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;cfg&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #aa3731;font-weight: bold;&quot;&gt;GetKernelVersion&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;(),&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #333333;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;FirecrackerVersion&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;cfg&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #aa3731;font-weight: bold;&quot;&gt;GetFirecrackerVersion&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;(),&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="690" y="560" width="570" height="80" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-86" value="&lt;div style=&quot;color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 12px; line-height: 16px;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #aaaaaa;font-style: italic;&quot;&gt;// default to scope by template ID&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;cacheScope&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;:=&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;cfg&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #aa3731;font-weight: bold;&quot;&gt;GetTemplateID&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;()&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #4b69c6;&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;templateRequest&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;CacheScope&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;!=&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9c5d27;&quot;&gt;nil&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #333333;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;cacheScope&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;templateRequest&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #aa3731;font-weight: bold;&quot;&gt;GetCacheScope&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;()&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #777777;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="657" y="650" width="350" height="100" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-87" value="&lt;ul style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; margin: 0px 0px 0px 16px; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; padding: 0px;&quot;&gt;&lt;li data-indent=&quot;0&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; margin-bottom: 2px !important; margin-top: 2px !important; margin-left: 0px; padding-top: 2px; padding-bottom: 2px; list-style-type: disc;&quot;&gt;&lt;span class=&quot;markdown-bold-text&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; font-weight: 600;&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;默&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;认情&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;况&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;: 使&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;用&lt;span&gt;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;markdown-inline-code leading-[1.4]&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; line-height: 1.4; background-color: color(srgb 0.747556 0.747556 0.747556 / 0.420392); border-radius: 4px; color: inherit; font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.9em; padding: 1.5px 3px; transition: 0.1s; word-break: break-all; cursor: default;&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;templateID&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;&lt;span&gt;&amp;nbsp;&lt;/span&gt;作&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;为缓存作&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;用域&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;,意&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;味着同&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;一个模&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;板的不&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;同构&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;建可&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;以共享&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;缓存&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;ul style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; margin: 0px 0px 0px 16px; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; padding: 0px;&quot;&gt;&lt;li data-indent=&quot;0&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; margin-bottom: 2px !important; margin-top: 2px !important; margin-left: 0px; padding-top: 2px; padding-bottom: 2px; list-style-type: disc;&quot;&gt;&lt;span class=&quot;markdown-bold-text&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; font-weight: 600;&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;自&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;定义&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;: 可以通过&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;请&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;求中的&lt;span&gt;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;markdown-inline-code leading-[1.4]&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; line-height: 1.4; background-color: color(srgb 0.747556 0.747556 0.747556 / 0.420392); border-radius: 4px; color: inherit; font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.9em; padding: 1.5px 3px; transition: 0.1s; word-break: break-all; cursor: default;&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;C&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;acheScope&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;&lt;span&gt;&amp;nbsp;&lt;/span&gt;来自&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;定义&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;,允&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;许&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;跨模&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;板共享构&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;建缓存&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1007" y="663" width="560" height="70" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-88" value="&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;用&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;于从私&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;有镜像仓库&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;拉取&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span&gt;&amp;nbsp;&lt;/span&gt;Docker 镜像&lt;/span&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="653" y="768" width="250" height="40" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-89" value="&lt;font face=&quot;Segoe WPC, Segoe UI, sans-serif&quot; color=&quot;#333333&quot;&gt;&lt;span style=&quot;font-size: 13px; background-color: rgb(242, 242, 242);&quot;&gt;V1：空白环境构建&lt;br&gt;&lt;/span&gt;&lt;/font&gt;V2：Docker镜像构建/已有模板继承" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="671" y="867" width="250" height="40" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-91" value="&lt;div style=&quot;background-color: rgb(245, 245, 245); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;color: rgb(122, 62, 157);&quot;&gt;Force&lt;/span&gt;&lt;font color=&quot;#777777&quot;&gt;&amp;nbsp;// 是否忽略缓存强制重新构建&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(51, 51, 51);&quot;&gt;&lt;span style=&quot;color: #333333;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="679.5" y="972" width="340" height="40" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-93" value="缓存中找到，则创建失败&#xa;（防止重复提交/并发冲突）" style="text;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="270" y="1298" width="250" height="50" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-96" value="&lt;div style=&quot;color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 12px; line-height: 16px;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #aaaaaa;font-style: italic;&quot;&gt;// 用户 A 触发构建&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;wg&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #aa3731;font-weight: bold;&quot;&gt;Add&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #9c5d27;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #aaaaaa;font-style: italic;&quot;&gt;// 计数器: 1&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #4b69c6;&quot;&gt;go&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #aa3731;font-weight: bold;&quot;&gt;build_A&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;()&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #aaaaaa;font-style: italic;&quot;&gt;// 用户 B 触发构建 &amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;wg&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #aa3731;font-weight: bold;&quot;&gt;Add&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #9c5d27;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #aaaaaa;font-style: italic;&quot;&gt;// 计数器: 2&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #4b69c6;&quot;&gt;go&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #aa3731;font-weight: bold;&quot;&gt;build_B&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;()&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #aaaaaa;font-style: italic;&quot;&gt;// 用户 C 触发构建&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;wg&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #aa3731;font-weight: bold;&quot;&gt;Add&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #9c5d27;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #aaaaaa;font-style: italic;&quot;&gt;// 计数器: 3&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #4b69c6;&quot;&gt;go&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #aa3731;font-weight: bold;&quot;&gt;build_C&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;()&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #aaaaaa;font-style: italic;&quot;&gt;// 服务关闭时&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;wg&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #aa3731;font-weight: bold;&quot;&gt;Wait&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #aaaaaa;font-style: italic;&quot;&gt;// 阻塞,直到所有 3 个构建完成&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #aaaaaa;font-style: italic;&quot;&gt;// build_A 完成&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;wg&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #aa3731;font-weight: bold;&quot;&gt;Done&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #aaaaaa;font-style: italic;&quot;&gt;// 计数器: 2&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #aaaaaa;font-style: italic;&quot;&gt;// build_B 完成&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;wg&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #aa3731;font-weight: bold;&quot;&gt;Done&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #aaaaaa;font-style: italic;&quot;&gt;// 计数器: 1&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #aaaaaa;font-style: italic;&quot;&gt;// build_C 完成&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;wg&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #aa3731;font-weight: bold;&quot;&gt;Done&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #aaaaaa;font-style: italic;&quot;&gt;// 计数器: 0&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #aaaaaa;font-style: italic;&quot;&gt;// wg.Wait() 解除阻塞,继续关闭流程&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1050" y="1230" width="280" height="420" as="geometry" />
        </mxCell>
        <mxCell id="fZ5MmAq4PVk6pfhPcHnG-97" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=-0.016;entryY=0.459;entryDx=0;entryDy=0;entryPerimeter=0;shape=flexArrow;" parent="1" source="fZ5MmAq4PVk6pfhPcHnG-15" target="fZ5MmAq4PVk6pfhPcHnG-96" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="8x-Zx35uA3Dm9bowCOF4" name="2.TemplateStatus">
    <mxGraphModel dx="1335" dy="811" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="QMtvh-NIwLkLIzDmIkug-1" value="开始 TemplateBuildStatus" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="520" y="230" width="207" height="34" as="geometry" />
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-2" value="设置追踪&#xa;tracer.Start(&#39;template-build-status-request&#39;)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="458" y="314" width="330" height="50" as="geometry" />
        </mxCell>
        <UserObject label="从缓存获取构建信息&#xa;s.buildCache.Get(buildID)" id="QMtvh-NIwLkLIzDmIkug-3">
          <mxCell style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
            <mxGeometry x="523" y="413" width="200" height="50" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-4" value="设置日志条目限制&#xa;limit = min(request.limit, maxLogEntriesPerRequest)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="427" y="513" width="393" height="50" as="geometry" />
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-5" value="初始化日志数组&#xa;logEntries = []&#xa;logsCrawled = 0" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="559" y="612" width="128" height="66" as="geometry" />
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-6" value="遍历所有日志&#xa;for _, entry := range buildInfo.GetLogs()" style="rhombus;strokeWidth=2;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="446" y="728" width="354" height="354" as="geometry" />
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-7" value="日志级别过滤&#xa;entry.Level &amp;gt;= request.Level?" style="rhombus;strokeWidth=2;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="395" y="1151" width="298" height="298" as="geometry" />
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-8" value="增加计数&#xa;logsCrawled++" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="485" y="1517" width="118" height="50" as="geometry" />
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-9" value="检查偏移&#xa;logsCrawled &lt;= offset?" style="rhombus;strokeWidth=2;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="508" y="1610" width="230" height="240" as="geometry" />
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-10" value="检查数量限制&#xa;len(logEntries) &gt;= limit?" style="rhombus;strokeWidth=2;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="500" y="1924" width="247" height="247" as="geometry" />
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-11" value="跳出循环" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="890" y="2248" width="79" height="34" as="geometry" />
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-12" value="添加日志&#xa;append(logEntries, entry)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="616" y="2240" width="199" height="50" as="geometry" />
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-13" value="获取构建结果&#xa;result = buildInfo.GetResult()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="605" y="2340" width="225" height="50" as="geometry" />
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-14" value="result == nil?" style="rhombus;strokeWidth=2;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="648" y="2440" width="140" height="140" as="geometry" />
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-15" value="返回构建中状态&#xa;TemplateBuildStatusResponse{&#xa;  Status: Building,&#xa;  LogEntries: logEntries&#xa;}" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="460" y="2664" width="233" height="98" as="geometry" />
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-16" value="返回完成状态&#xa;TemplateBuildStatusResponse{&#xa;  Status: result.Status,&#xa;  Reason: result.Reason,&#xa;  Metadata: result.Metadata,&#xa;  LogEntries: logEntries&#xa;}" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="743" y="2648" width="233" height="130" as="geometry" />
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-17" value="结束" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="690" y="2828" width="56" height="34" as="geometry" />
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-18" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49846522013346356;exitY=0.9873950060676125;entryX=0.5005524259625059;entryY=-0.008571395874023438;rounded=0;" parent="1" source="QMtvh-NIwLkLIzDmIkug-1" target="QMtvh-NIwLkLIzDmIkug-2" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-19" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5005524259625059;exitY=0.9828572082519531;entryX=0.5009115028381348;entryY=0.002857208251953125;rounded=0;" parent="1" source="QMtvh-NIwLkLIzDmIkug-2" target="QMtvh-NIwLkLIzDmIkug-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-20" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5009115028381348;exitY=0.9942858123779297;entryX=0.4991916044977785;entryY=-0.005714187622070313;rounded=0;" parent="1" source="QMtvh-NIwLkLIzDmIkug-3" target="QMtvh-NIwLkLIzDmIkug-4" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-21" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4991916044977785;exitY=0.9857144165039062;entryX=0.5014242231845856;entryY=0.004329103412050189;rounded=0;" parent="1" source="QMtvh-NIwLkLIzDmIkug-4" target="QMtvh-NIwLkLIzDmIkug-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-22" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5014242231845856;exitY=0.9978355638908617;entryX=0.5005149733548784;entryY=-0.00040353893560204804;rounded=0;" parent="1" source="QMtvh-NIwLkLIzDmIkug-5" target="QMtvh-NIwLkLIzDmIkug-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-23" value="有下一条" style="curved=1;startArrow=none;endArrow=block;exitX=0.15704409934499453;exitY=1.0000126725536282;entryX=0.3200991608270317;entryY=-0.0014230996970362312;rounded=0;" parent="1" source="QMtvh-NIwLkLIzDmIkug-6" target="QMtvh-NIwLkLIzDmIkug-7" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="478" y="1116" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-24" value="否" style="curved=1;startArrow=none;endArrow=block;exitX=0.7127527071555119;exitY=-0.0014230996970362312;entryX=0.4976755547601085;entryY=1.0000126725536282;rounded=0;" parent="1" source="QMtvh-NIwLkLIzDmIkug-7" target="QMtvh-NIwLkLIzDmIkug-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="622" y="1116" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-25" value="是" style="curved=1;startArrow=none;endArrow=block;entryX=0.5001576957056078;entryY=0.003869781494140625;rounded=0;" parent="1" target="QMtvh-NIwLkLIzDmIkug-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
            <mxPoint x="544" y="1450" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-26" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5001576957056078;exitY=0.9952983856201172;entryX=0.18288618604030707;entryY=-0.0009795029958089192;rounded=0;" parent="1" source="QMtvh-NIwLkLIzDmIkug-8" target="QMtvh-NIwLkLIzDmIkug-9" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="544" y="1592" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-27" value="否" style="curved=1;startArrow=none;endArrow=block;exitX=0.8173650117746344;exitY=-0.0009795029958089192;entryX=0.7486776530552371;entryY=1.0000126725536282;rounded=0;" parent="1" source="QMtvh-NIwLkLIzDmIkug-9" target="QMtvh-NIwLkLIzDmIkug-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="728" y="1592" />
              <mxPoint x="728" y="1116" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-28" value="是" style="curved=1;startArrow=none;endArrow=block;entryX=0.4980977479262873;entryY=0.0006207300101214575;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="QMtvh-NIwLkLIzDmIkug-9" target="QMtvh-NIwLkLIzDmIkug-10" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
            <mxPoint x="660" y="1870" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-29" value="否" style="curved=1;startArrow=none;endArrow=block;exitX=0.9973989015648722;exitY=0.76778706969113;entryX=0.5040661413458329;entryY=0.011162365184110753;rounded=0;" parent="1" source="QMtvh-NIwLkLIzDmIkug-10" target="QMtvh-NIwLkLIzDmIkug-11" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="930" y="2206" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-30" value="是" style="curved=1;startArrow=none;endArrow=block;exitX=0.4980977479262873;exitY=0.9992230372872912;entryX=0.33154588610010216;entryY=0.007590408325195312;rounded=0;" parent="1" source="QMtvh-NIwLkLIzDmIkug-10" target="QMtvh-NIwLkLIzDmIkug-12" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="636" y="2206" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-31" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.7220858192003442;exitY=0.007590408325195312;entryX=0.9692737426030446;entryY=1.0000126725536282;rounded=0;" parent="1" source="QMtvh-NIwLkLIzDmIkug-12" target="QMtvh-NIwLkLIzDmIkug-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="821" y="2206" />
              <mxPoint x="821" y="1116" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-32" value="无更多" style="curved=1;startArrow=none;endArrow=block;exitX=0.00030686761026328565;exitY=0.9015104727545887;entryX=-0.000007578531901041666;entryY=0.1810087195442429;rounded=0;" parent="1" source="QMtvh-NIwLkLIzDmIkug-6" target="QMtvh-NIwLkLIzDmIkug-13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="360" y="1116" />
              <mxPoint x="360" y="2315" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-33" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5040661413458329;exitY=0.9985573712517234;entryX=0.9702470056991284;entryY=-0.000980987548828125;rounded=0;" parent="1" source="QMtvh-NIwLkLIzDmIkug-11" target="QMtvh-NIwLkLIzDmIkug-13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="930" y="2315" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-34" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.500901845296224;exitY=0.9904476165771484;entryX=0.49787796565464565;entryY=-0.0034115655081612723;rounded=0;" parent="1" source="QMtvh-NIwLkLIzDmIkug-13" target="QMtvh-NIwLkLIzDmIkug-14" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-35" value="是" style="curved=1;startArrow=none;endArrow=block;exitX=-0.0024675369262695313;exitY=0.866464656831678;entryX=0.4997180562162604;entryY=0.0019443278409996812;rounded=0;" parent="1" source="QMtvh-NIwLkLIzDmIkug-14" target="QMtvh-NIwLkLIzDmIkug-15" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="576" y="2614" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-36" value="否" style="curved=1;startArrow=none;endArrow=block;exitX=0.9982234682355609;exitY=0.866464656831678;entryX=0.4977318595918975;entryY=0.0014657827524038462;rounded=0;" parent="1" source="QMtvh-NIwLkLIzDmIkug-14" target="QMtvh-NIwLkLIzDmIkug-16" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="859" y="2614" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-37" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4997180562162604;exitY=0.9975712834572306;entryX=-0.0015423297882080078;entryY=0.244938980246268;rounded=0;" parent="1" source="QMtvh-NIwLkLIzDmIkug-15" target="QMtvh-NIwLkLIzDmIkug-17" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="576" y="2803" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="QMtvh-NIwLkLIzDmIkug-38" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4977318595918975;exitY=0.9981690626878005;entryX=0.9909321580614362;entryY=0.244938980246268;rounded=0;" parent="1" source="QMtvh-NIwLkLIzDmIkug-16" target="QMtvh-NIwLkLIzDmIkug-17" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="859" y="2803" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="XFn-p64VD3kFJc96BDi0-1" value="&lt;span style=&quot;color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: center; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(236, 236, 236); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;&quot;&gt;创建模板同时创建了缓存s.buildCache.Create&lt;/span&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="770" y="413" width="150" height="40" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="tqLhwv4AALbIk3n3LWPJ" name="3.TemplateBuildDelete">
    <mxGraphModel dx="2162" dy="811" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-1" value="开始 TemplateBuildDelete" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="-286" y="100" width="211" height="39" as="geometry" />
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-2" value="设置追踪&#xa;tracer.Start(&#39;template-delete-request&#39;)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="-310" y="189" width="260" height="78" as="geometry" />
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-3" value="增加等待组&#xa;s.wg.Add(1)&#xa;defer s.wg.Done()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="-275" y="317" width="189" height="102" as="geometry" />
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-4" value="验证参数&#xa;templateID 和 buildID&#xa;是否都存在?" style="rhombus;strokeWidth=2;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-309" y="469" width="257" height="257" as="geometry" />
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-5" value="返回错误&#xa;&#39;template id and build id&#xa;are required fields&#39;" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="-175" y="1913" width="236" height="102" as="geometry" />
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-6" value="从构建缓存获取构建信息&#xa;s.buildCache.Get(buildID)" style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="-426" y="800" width="245" height="78" as="geometry" />
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-7" value="构建正在运行?&#xa;err == nil &amp;amp;&amp;amp; IsRunning()" style="rhombus;strokeWidth=2;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-431" y="928" width="255" height="255" as="geometry" />
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-8" value="记录日志&#xa;&#39;Canceling running template build&#39;" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="-520" y="1257" width="260" height="78" as="geometry" />
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-9" value="上报事件&#xa;telemetry.ReportEvent(&#xa;&#39;cancel in progress template build&#39;)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="-520" y="1409" width="260" height="102" as="geometry" />
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-10" value="取消构建&#xa;buildInfo.SetFail(&#xa;&#39;Build was canceled&#39;)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="-494" y="1561" width="207" height="102" as="geometry" />
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-11" value="删除模板&#xa;template.Delete(ctx,&#xa;artifactsregistry,&#xa;templateStorage,&#xa;templateID, buildID)" style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="-410" y="1713" width="212" height="150" as="geometry" />
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-12" value="返回成功&#xa;return nil, nil" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="-382" y="1925" width="157" height="78" as="geometry" />
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-13" value="结束" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="-209" y="2065" width="57" height="39" as="geometry" />
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-14" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" parent="1" source="tX0JPEP_T1rLlgXqnm6X-1" target="tX0JPEP_T1rLlgXqnm6X-2" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-15" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" parent="1" source="tX0JPEP_T1rLlgXqnm6X-2" target="tX0JPEP_T1rLlgXqnm6X-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-16" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" parent="1" source="tX0JPEP_T1rLlgXqnm6X-3" target="tX0JPEP_T1rLlgXqnm6X-4" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-17" value="否" style="curved=1;startArrow=none;endArrow=block;exitX=0.87;exitY=1;entryX=0.5;entryY=0;rounded=0;" parent="1" source="tX0JPEP_T1rLlgXqnm6X-4" target="tX0JPEP_T1rLlgXqnm6X-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-57" y="763" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-18" value="是" style="curved=1;startArrow=none;endArrow=block;exitX=0.13;exitY=1;entryX=0.5;entryY=0.01;rounded=0;" parent="1" source="tX0JPEP_T1rLlgXqnm6X-4" target="tX0JPEP_T1rLlgXqnm6X-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-304" y="763" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-19" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" parent="1" source="tX0JPEP_T1rLlgXqnm6X-6" target="tX0JPEP_T1rLlgXqnm6X-7" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-20" value="是" style="curved=1;startArrow=none;endArrow=block;exitX=0.24;exitY=1;entryX=0.5;entryY=0;rounded=0;" parent="1" source="tX0JPEP_T1rLlgXqnm6X-7" target="tX0JPEP_T1rLlgXqnm6X-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-390" y="1220" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-21" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" parent="1" source="tX0JPEP_T1rLlgXqnm6X-8" target="tX0JPEP_T1rLlgXqnm6X-9" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-22" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" parent="1" source="tX0JPEP_T1rLlgXqnm6X-9" target="tX0JPEP_T1rLlgXqnm6X-10" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-23" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.2;entryY=0;rounded=0;" parent="1" source="tX0JPEP_T1rLlgXqnm6X-10" target="tX0JPEP_T1rLlgXqnm6X-11" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-390" y="1688" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-24" value="否" style="curved=1;startArrow=none;endArrow=block;exitX=0.83;exitY=1;entryX=0.89;entryY=0;rounded=0;" parent="1" source="tX0JPEP_T1rLlgXqnm6X-7" target="tX0JPEP_T1rLlgXqnm6X-11" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-194" y="1220" />
              <mxPoint x="-194" y="1688" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-25" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" parent="1" source="tX0JPEP_T1rLlgXqnm6X-11" target="tX0JPEP_T1rLlgXqnm6X-12" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-26" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.01;entryY=0.24;rounded=0;" parent="1" source="tX0JPEP_T1rLlgXqnm6X-12" target="tX0JPEP_T1rLlgXqnm6X-13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-304" y="2040" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="tX0JPEP_T1rLlgXqnm6X-27" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=1;entryY=0.24;rounded=0;" parent="1" source="tX0JPEP_T1rLlgXqnm6X-5" target="tX0JPEP_T1rLlgXqnm6X-13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-57" y="2040" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="XpCtk68bk0XhJZLEeRNf-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="XpCtk68bk0XhJZLEeRNf-1" target="XpCtk68bk0XhJZLEeRNf-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XpCtk68bk0XhJZLEeRNf-1" value="删除模板文件&#xa;templateStorage.DeleteObjectsWithPrefix" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="-820" y="1700" width="240" height="100" as="geometry" />
        </mxCell>
        <mxCell id="XpCtk68bk0XhJZLEeRNf-3" value="删除镜像？&#xa;artifactRegistry.Delete" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="-820" y="1870" width="240" height="102" as="geometry" />
        </mxCell>
        <mxCell id="XpCtk68bk0XhJZLEeRNf-6" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1.005;entryY=0.448;entryDx=0;entryDy=0;entryPerimeter=0;shape=flexArrow;" parent="1" source="tX0JPEP_T1rLlgXqnm6X-11" target="XpCtk68bk0XhJZLEeRNf-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="GoMd_xM2JTnv6zPLcpyr" name="4.InitLayerFileUpload">
    <mxGraphModel dx="1335" dy="811" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="2DkqwLu_qLiOgQggEbb0-1" value="开始 InitLayerFileUpload" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="279" y="60" width="201" height="39" as="geometry" />
        </mxCell>
        <mxCell id="2DkqwLu_qLiOgQggEbb0-2" value="设置追踪&#xa;tracer.Start(&#39;template-create&#39;)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="250" y="149" width="260" height="78" as="geometry" />
        </mxCell>
        <mxCell id="2DkqwLu_qLiOgQggEbb0-3" value="获取缓存作用域&#xa;cacheScope = &#xa;优先request.cacheScope&#xa;默认templateID" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="259" y="277" width="241" height="102" as="geometry" />
        </mxCell>
        <mxCell id="2DkqwLu_qLiOgQggEbb0-4" value="获取层文件路径&#xa;paths.GetLayerFilesCachePath(&#xa;  cacheScope, hash)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="250" y="429" width="260" height="102" as="geometry" />
        </mxCell>
        <mxCell id="2DkqwLu_qLiOgQggEbb0-5" value="打开存储对象&#xa;s.buildStorage.OpenObject(&#xa;  path, BuildLayerFileObjectType)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="250" y="581" width="260" height="102" as="geometry" />
        </mxCell>
        <mxCell id="2DkqwLu_qLiOgQggEbb0-6" value="获取预签名上传 URL&#xa;s.buildStorage.UploadSignedURL(&#xa;  path, expiration)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="250" y="733" width="260" height="102" as="geometry" />
        </mxCell>
        <mxCell id="2DkqwLu_qLiOgQggEbb0-7" value="检查文件是否存在&#xa;obj.Exists()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="286" y="885" width="188" height="78" as="geometry" />
        </mxCell>
        <mxCell id="2DkqwLu_qLiOgQggEbb0-8" value="返回响应&#xa;InitLayerFileUploadResponse{&#xa;  Present: exists,&#xa;  Url: signedUrl&#xa;}" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="250" y="1013" width="260" height="150" as="geometry" />
        </mxCell>
        <mxCell id="2DkqwLu_qLiOgQggEbb0-9" value="结束" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="352" y="1213" width="57" height="39" as="geometry" />
        </mxCell>
        <mxCell id="2DkqwLu_qLiOgQggEbb0-10" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" parent="1" source="2DkqwLu_qLiOgQggEbb0-1" target="2DkqwLu_qLiOgQggEbb0-2" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2DkqwLu_qLiOgQggEbb0-11" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" parent="1" source="2DkqwLu_qLiOgQggEbb0-2" target="2DkqwLu_qLiOgQggEbb0-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2DkqwLu_qLiOgQggEbb0-12" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" parent="1" source="2DkqwLu_qLiOgQggEbb0-3" target="2DkqwLu_qLiOgQggEbb0-4" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2DkqwLu_qLiOgQggEbb0-13" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" parent="1" source="2DkqwLu_qLiOgQggEbb0-4" target="2DkqwLu_qLiOgQggEbb0-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2DkqwLu_qLiOgQggEbb0-14" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" parent="1" source="2DkqwLu_qLiOgQggEbb0-5" target="2DkqwLu_qLiOgQggEbb0-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2DkqwLu_qLiOgQggEbb0-15" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" parent="1" source="2DkqwLu_qLiOgQggEbb0-6" target="2DkqwLu_qLiOgQggEbb0-7" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2DkqwLu_qLiOgQggEbb0-16" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" parent="1" source="2DkqwLu_qLiOgQggEbb0-7" target="2DkqwLu_qLiOgQggEbb0-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2DkqwLu_qLiOgQggEbb0-17" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.49;entryY=0;rounded=0;" parent="1" source="2DkqwLu_qLiOgQggEbb0-8" target="2DkqwLu_qLiOgQggEbb0-9" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6c56WQs806jxl8vRwlnv-2" value="缓存可以在多模板之间共享" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="560" y="313" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6c56WQs806jxl8vRwlnv-3" value="&lt;span style=&quot;color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;&quot;&gt;客户端可以直接用这个URL上传文件到存储服务（如S3/GCS），无需通过服务器中转&lt;/span&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="540" y="764" width="510" height="40" as="geometry" />
        </mxCell>
        <mxCell id="6c56WQs806jxl8vRwlnv-4" value="&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;在模板构建中使用&lt;span&gt;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;markdown-inline-code leading-[1.4]&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; line-height: 1.4; background-color: color(srgb 0.747556 0.747556 0.747556 / 0.420392); border-radius: 4px; color: inherit; font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.9em; padding: 1.5px 3px; transition: 0.1s; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; word-break: break-all; cursor: default;&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;COPY&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span&gt;&amp;nbsp;&lt;/span&gt;或&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span&gt;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;markdown-inline-code leading-[1.4]&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; line-height: 1.4; background-color: color(srgb 0.747556 0.747556 0.747556 / 0.420392); border-radius: 4px; color: inherit; font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.9em; padding: 1.5px 3px; transition: 0.1s; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; word-break: break-all; cursor: default;&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;ADD&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span&gt;&amp;nbsp;&lt;/span&gt;指令时&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;，需要把&lt;/span&gt;&lt;span class=&quot;markdown-bold-text&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; font-weight: 600;&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;本地文件&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;传&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;输到远&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;程的&lt;span&gt;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;markdown-bold-text&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; font-weight: 600;&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;Sandbox&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;&lt;span&gt;&amp;nbsp;&lt;/span&gt;中&lt;br&gt;如果没有缓存，每次都需要重新传输&lt;/span&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="850" y="99" width="560" height="71" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="Si-DR3fJ-AE2JFd4cjZ9" name="builder.Build">
    <mxGraphModel dx="2734" dy="1159" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-56" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;dashed=1;dashPattern=1 1;" parent="1" vertex="1">
          <mxGeometry x="63" y="2830" width="407" height="810" as="geometry" />
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-2" value="开始 Build 方法" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="218" y="330" width="133" height="34" as="geometry" />
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-3" value="设置追踪&#xa;tracer.Start(&#39;build&#39;)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="210" y="414" width="150" height="50" as="geometry" />
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-4" value="记录开始时间&#xa;startTime := time.Now()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="190" y="513" width="189" height="50" as="geometry" />
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-5" value="defer 记录指标&#xa;RecordBuildDuration()&#xa;RecordBuildResult()&#xa;RecordRootfsSize()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="198" y="613" width="173" height="82" as="geometry" />
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-6" value="获取缓存作用域&#xa;cacheScope := cfg.CacheScope" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="167" y="744" width="236" height="50" as="geometry" />
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-7" value="验证并强制步骤&#xa;cfg = forceSteps(cfg)" style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="203" y="844" width="164" height="50" as="geometry" />
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-8" value="判断构建版本&#xa;isV1Build = IsVersion() || ..." style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="177" y="943" width="216" height="50" as="geometry" />
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-9" value="创建日志记录器&#xa;logger := zap.New(logsCore)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="176" y="1043" width="217" height="50" as="geometry" />
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-10" value="defer 记录日志&#xa;根据结果记录：&#xa;- Canceled&#xa;- Failed&#xa;- Success" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="221" y="1143" width="127" height="98" as="geometry" />
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-11" value="defer panic 恢复&#xa;recover() + ReportCriticalError()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="162" y="1290" width="246" height="50" as="geometry" />
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-12" value="是否为 V1 构建?" style="rhombus;strokeWidth=2;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="204" y="1390" width="162" height="162" as="geometry" />
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-13" value="创建日志后处理器&#xa;writer.NewPostProcessor()&#xa;更新 logger" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="256" y="1621" width="203" height="66" as="geometry" />
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-14" value="记录开始日志&#xa;&#39;Building template...&#39;" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="202" y="1736" width="165" height="50" as="geometry" />
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-15" value="defer 失败清理&#xa;如果失败则删除构建文件&#xa;DeleteObjectsWithPrefix()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="183" y="1836" width="203" height="66" as="geometry" />
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-16" value="获取 envd 版本&#xa;envd.GetEnvdVersion()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="195" y="1951" width="179" height="50" as="geometry" />
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-17" value="返回错误&#xa;&#39;error getting envd version&#39;" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="311" y="2536" width="207" height="50" as="geometry" />
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-18" value="创建上传错误组&#xa;var uploadErrGroup errgroup.Group" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="20" y="2069" width="271" height="50" as="geometry" />
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-19" value="defer 等待上传&#xa;uploadErrGroup.Wait()&#xa;合并上传错误" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="67" y="2169" width="177" height="66" as="geometry" />
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-20" value="创建构建上下文&#xa;buildContext := BuildContext{&#xa;  BuilderConfig&#xa;  Config&#xa;  Template&#xa;  UploadErrGroup&#xa;  EnvdVersion&#xa;  CacheScope&#xa;  IsV1Build&#xa;  Version&#xa;}" style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="41" y="2285" width="230" height="194" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-55" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;curved=1;dashed=1;" parent="1" source="MIIjM6QFJNQARy6x5wqv-21" target="x1iQnE47CSqZXFiOeJ7c-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-21" value="执行构建&#xa;return runBuild(ctx, logger,&#xa;buildContext, b)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="50" y="2528" width="211" height="66" as="geometry" />
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-22" value="结束" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="257" y="2644" width="56" height="34" as="geometry" />
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-23" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.503046250881109;exitY=0.9873950060676125;entryX=0.49936767578125;entryY=-0.008571395874023438;rounded=0;" parent="1" source="MIIjM6QFJNQARy6x5wqv-2" target="MIIjM6QFJNQARy6x5wqv-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-24" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49936767578125;exitY=0.9828572082519531;entryX=0.5021436580274471;entryY=0.002857208251953125;rounded=0;" parent="1" source="MIIjM6QFJNQARy6x5wqv-3" target="MIIjM6QFJNQARy6x5wqv-4" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-25" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5021436580274471;exitY=0.9942858123779297;entryX=0.5023419154172688;entryY=-0.0034842607451648247;rounded=0;" parent="1" source="MIIjM6QFJNQARy6x5wqv-4" target="MIIjM6QFJNQARy6x5wqv-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-26" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5023419154172688;exitY=0.9912893248767387;entryX=0.4995980990135064;entryY=0.005714492797851562;rounded=0;" parent="1" source="MIIjM6QFJNQARy6x5wqv-5" target="MIIjM6QFJNQARy6x5wqv-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-27" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4995980990135064;exitY=0.9971430969238281;entryX=0.49942165467797256;entryY=-0.002856903076171875;rounded=0;" parent="1" source="MIIjM6QFJNQARy6x5wqv-6" target="MIIjM6QFJNQARy6x5wqv-7" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-28" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49942165467797256;exitY=0.9885717010498047;entryX=0.4995608859592014;entryY=0.008571701049804687;rounded=0;" parent="1" source="MIIjM6QFJNQARy6x5wqv-7" target="MIIjM6QFJNQARy6x5wqv-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-29" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4995608859592014;exitY=1.0000003051757813;entryX=0.5018670569916475;entryY=3.0517578125e-7;rounded=0;" parent="1" source="MIIjM6QFJNQARy6x5wqv-8" target="MIIjM6QFJNQARy6x5wqv-9" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-30" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5018670569916475;exitY=0.9914289093017579;entryX=0.5031901682455708;entryY=-0.0043730054582868305;rounded=0;" parent="1" source="MIIjM6QFJNQARy6x5wqv-9" target="MIIjM6QFJNQARy6x5wqv-10" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-31" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5031901682455708;exitY=0.991253950157944;entryX=0.4996144364519817;entryY=0.0028577423095703124;rounded=0;" parent="1" source="MIIjM6QFJNQARy6x5wqv-10" target="MIIjM6QFJNQARy6x5wqv-11" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-32" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4996144364519817;exitY=0.9942863464355469;entryX=0.49941451461226855;entryY=-0.0017634733223620756;rounded=0;" parent="1" source="MIIjM6QFJNQARy6x5wqv-11" target="MIIjM6QFJNQARy6x5wqv-12" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-33" value="是" style="curved=1;startArrow=none;endArrow=block;exitX=0.8128332529698535;exitY=1.0002207343960985;entryX=0.49816748191570415;entryY=-0.0059516791141394415;rounded=0;" parent="1" source="MIIjM6QFJNQARy6x5wqv-12" target="MIIjM6QFJNQARy6x5wqv-13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="357" y="1586" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-34" value="否" style="curved=1;startArrow=none;endArrow=block;exitX=0.18599577625468344;exitY=1.0002207343960985;entryX=0.28454034188668703;entryY=0.0035723114013671876;rounded=0;" parent="1" source="MIIjM6QFJNQARy6x5wqv-12" target="MIIjM6QFJNQARy6x5wqv-14" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="213" y="1586" />
              <mxPoint x="213" y="1711" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-35" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49816748191570415;exitY=0.9875547813646721;entryX=0.7203705837761918;entryY=0.0035723114013671876;rounded=0;" parent="1" source="MIIjM6QFJNQARy6x5wqv-13" target="MIIjM6QFJNQARy6x5wqv-14" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="357" y="1711" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-36" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5024554628314394;exitY=0.9950009155273437;entryX=0.5019958195427956;entryY=-0.003787185206557765;rounded=0;" parent="1" source="MIIjM6QFJNQARy6x5wqv-14" target="MIIjM6QFJNQARy6x5wqv-15" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-37" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5019958195427956;exitY=0.9897192752722538;entryX=0.5022634154591481;entryY=0.006429443359375;rounded=0;" parent="1" source="MIIjM6QFJNQARy6x5wqv-15" target="MIIjM6QFJNQARy6x5wqv-16" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-38" value="失败" style="curved=1;startArrow=none;endArrow=block;exitX=0.8057326719165046;exitY=0.9978580474853516;entryX=0.4993603102826842;entryY=0.0035722732543945314;rounded=0;" parent="1" source="MIIjM6QFJNQARy6x5wqv-16" target="MIIjM6QFJNQARy6x5wqv-17" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="414" y="2035" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-39" value="成功" style="curved=1;startArrow=none;endArrow=block;exitX=0.1987941590017915;exitY=0.9978580474853516;entryX=0.49978862917291283;entryY=0.009286651611328125;rounded=0;" parent="1" source="MIIjM6QFJNQARy6x5wqv-16" target="MIIjM6QFJNQARy6x5wqv-18" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="155" y="2035" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-40" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49978862917291283;exitY=1.0007152557373047;entryX=0.4996763757393185;entryY=0.0005418604070490056;rounded=0;" parent="1" source="MIIjM6QFJNQARy6x5wqv-18" target="MIIjM6QFJNQARy6x5wqv-19" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-41" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4996763757393185;exitY=0.9940483208858606;entryX=0.4975770369819973;entryY=-0.0020247980491402222;rounded=0;" parent="1" source="MIIjM6QFJNQARy6x5wqv-19" target="MIIjM6QFJNQARy6x5wqv-20" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-42" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4975770369819973;exitY=0.9957660596395276;entryX=0.49972852372445203;entryY=0.0027062965161872635;rounded=0;" parent="1" source="MIIjM6QFJNQARy6x5wqv-20" target="MIIjM6QFJNQARy6x5wqv-21" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-43" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49972852372445203;exitY=0.9962127569949988;entryX=0.002069030489240374;entryY=0.22254108862167038;rounded=0;" parent="1" source="MIIjM6QFJNQARy6x5wqv-21" target="MIIjM6QFJNQARy6x5wqv-22" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="155" y="2619" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="MIIjM6QFJNQARy6x5wqv-44" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4993603102826842;exitY=0.9950008773803711;entryX=0.9945435183388847;entryY=0.22254108862167038;rounded=0;" parent="1" source="MIIjM6QFJNQARy6x5wqv-17" target="MIIjM6QFJNQARy6x5wqv-22" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="414" y="2619" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-1" value="1. 模板设置Force则全都Force&lt;br&gt;2. 否则，找到第一个设置了Force的Step，之后的Step都Force" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="420" y="854" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-2" value="开始 runBuild" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="193" y="2780" width="120" height="34" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-3" value="创建哈希索引&#xa;cache.NewHashIndex()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="164" y="2864" width="178" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-4" value="创建层执行器&#xa;layer.NewLayerExecutor()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="153" y="2963" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-5" value="创建基础构建器&#xa;base.New()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="190" y="3063" width="127" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-6" value="创建命令执行器&#xa;commands.NewCommandExecutor()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="117" y="3162" width="273" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-7" value="创建用户构建器&#xa;user.New()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="190" y="3262" width="127" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-8" value="创建步骤构建器&#xa;steps.CreateStepPhases()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="155" y="3361" width="196" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-9" value="创建后处理构建器&#xa;finalize.New()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="182" y="3461" width="143" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-10" value="初始化构建器数组&#xa;builders = [baseBuilder]" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="160" y="3561" width="185" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-11" value="检查版本&#xa;IsGTEVersion(TemplateV2ReleaseVersion)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="99" y="3660" width="308" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-12" value="返回错误&#xa;&#39;error checking build version&#39;" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="-310" y="4789" width="220" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-13" value="版本 &gt;= V2?" style="rhombus;strokeWidth=2;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="296" y="3778" width="131" height="131" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-14" value="添加用户构建器&#xa;append(builders, userBuilder)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="-132" y="3977" width="228" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-15" value="添加步骤构建器&#xa;append(builders, stepBuilders...)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="235" y="4077" width="253" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-16" value="添加后处理构建器&#xa;append(builders, postProcessingBuilder)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="210" y="4177" width="302" height="50" as="geometry" />
        </mxCell>
        <UserObject label="运行所有阶段&#xa;phases.Run(ctx, userLogger,&#xa;bc, metrics, builders)" link="data:page/id,HDK8y8DbsJZ6458C_AIx" id="x1iQnE47CSqZXFiOeJ7c-17">
          <mxCell style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
            <mxGeometry x="253" y="4295" width="215" height="66" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-18" value="返回构建错误" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="-40" y="4797" width="112" height="34" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-19" value="等待上传完成&#xa;bc.UploadErrGroup.Wait()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="373" y="4429" width="202" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-20" value="返回错误&#xa;&#39;error waiting for layers upload&#39;" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="122" y="4789" width="239" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-21" value="获取 rootfs 大小&#xa;getRootfsSize()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="541" y="4547" width="131" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-22" value="返回错误&#xa;&#39;error getting rootfs size&#39;" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="411" y="4789" width="191" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-23" value="记录日志&#xa;zap.L().Info(&#39;rootfs size&#39;)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="611" y="4665" width="190" height="50" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-24" value="返回结果&#xa;Result{&#xa;  EnvdVersion&#xa;  RootfsSizeMB&#xa;}" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="652" y="4765" width="109" height="98" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-25" value="结束" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="214" y="4912" width="56" height="34" as="geometry" />
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-26" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5010667324066163;exitY=0.9873950060676125;entryX=0.5007191454426626;entryY=-0.008571395874023438;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-2" target="x1iQnE47CSqZXFiOeJ7c-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-27" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5007191454426626;exitY=0.9828572082519531;entryX=0.5006400394439697;entryY=0.002857208251953125;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-3" target="x1iQnE47CSqZXFiOeJ7c-4" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-28" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5006400394439697;exitY=0.9942858123779297;entryX=0.49707092825822;entryY=-0.005714187622070313;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-4" target="x1iQnE47CSqZXFiOeJ7c-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-29" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49707092825822;exitY=0.9857144165039062;entryX=0.49863739153404374;entryY=0.00571441650390625;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-5" target="x1iQnE47CSqZXFiOeJ7c-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-30" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49863739153404374;exitY=0.9971430206298828;entryX=0.49707092825822;entryY=-0.0028569793701171877;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-6" target="x1iQnE47CSqZXFiOeJ7c-7" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-31" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49707092825822;exitY=0.9885716247558594;entryX=0.5006531014734384;entryY=0.008571624755859375;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-7" target="x1iQnE47CSqZXFiOeJ7c-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-32" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5006531014734384;exitY=1.000000228881836;entryX=0.4973986565649926;entryY=2.288818359375e-7;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-8" target="x1iQnE47CSqZXFiOeJ7c-9" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-33" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4973986565649926;exitY=0.9914288330078125;entryX=0.5033946372367241;entryY=-0.0085711669921875;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-9" target="x1iQnE47CSqZXFiOeJ7c-10" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-34" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5033946372367241;exitY=0.982857437133789;entryX=0.5004156100285517;entryY=0.0028574371337890623;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-10" target="x1iQnE47CSqZXFiOeJ7c-11" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-35" value="失败" style="curved=1;startArrow=none;endArrow=block;exitX=-0.000041014188295835024;exitY=0.9005476472764576;entryX=0.5004566192626954;entryY=-0.004344215393066406;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-11" target="x1iQnE47CSqZXFiOeJ7c-12" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-200" y="3744" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-36" value="成功" style="curved=1;startArrow=none;endArrow=block;exitX=0.6474909678187898;exitY=0.9942860412597656;entryX=0.49686220766023825;entryY=0.0021811623609703005;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-11" target="x1iQnE47CSqZXFiOeJ7c-13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="361" y="3744" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-37" value="是" style="curved=1;startArrow=none;endArrow=block;exitX=-0.0017633365310785424;exitY=0.632047692494601;entryX=0.502876733478747;entryY=0.00994110107421875;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-13" target="x1iQnE47CSqZXFiOeJ7c-14" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-17" y="3943" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-38" value="否" style="curved=1;startArrow=none;endArrow=block;exitX=0.8905443322412616;exitY=0.9994322507436039;entryX=0.6531255502345311;entryY=0.0013697052001953125;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-13" target="x1iQnE47CSqZXFiOeJ7c-15" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="440" y="3943" />
              <mxPoint x="440" y="4052" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-39" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.502876733478747;exitY=1.0013697052001953;entryX=-0.0011659478952762167;entryY=0.1645488617852334;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-14" target="x1iQnE47CSqZXFiOeJ7c-15" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-17" y="4052" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-40" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49837529329443164;exitY=0.9927983093261719;entryX=0.5002945337863948;entryY=-0.007201690673828125;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-15" target="x1iQnE47CSqZXFiOeJ7c-16" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-41" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5002945337863948;exitY=0.9842269134521484;entryX=0.5027392986208894;entryY=-0.003291274562026515;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-16" target="x1iQnE47CSqZXFiOeJ7c-17" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-42" value="失败" style="curved=1;startArrow=none;endArrow=block;exitX=0.0022720603055732193;exitY=0.8103492266312673;entryX=0.500199454171317;entryY=-0.006388552048627068;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-17" target="x1iQnE47CSqZXFiOeJ7c-18" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="16" y="4395" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-43" value="成功" style="curved=1;startArrow=none;endArrow=block;exitX=0.7590438980837741;exitY=0.990215185916785;entryX=0.49911433871429745;entryY=-0.0014873504638671874;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-17" target="x1iQnE47CSqZXFiOeJ7c-19" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="474" y="4395" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-44" value="失败" style="curved=1;startArrow=none;endArrow=block;exitX=0.016515543533863378;exitY=0.9899412536621094;entryX=0.49994407238820604;entryY=-0.004344215393066406;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-19" target="x1iQnE47CSqZXFiOeJ7c-20" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="241" y="4513" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-45" value="成功" style="curved=1;startArrow=none;endArrow=block;exitX=0.7743629172418343;exitY=0.9899412536621094;entryX=0.4987195866708537;entryY=0.0013698577880859376;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-19" target="x1iQnE47CSqZXFiOeJ7c-21" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="606" y="4513" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-46" value="失败" style="curved=1;startArrow=none;endArrow=block;exitX=0.17898871824424883;exitY=0.9927984619140625;entryX=0.500046974701407;entryY=-0.004344215393066406;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-21" target="x1iQnE47CSqZXFiOeJ7c-22" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="507" y="4631" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-47" value="成功" style="curved=1;startArrow=none;endArrow=block;exitX=0.8184504550974586;exitY=0.9927984619140625;entryX=0.5008187344199733;entryY=0.004227066040039062;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-21" target="x1iQnE47CSqZXFiOeJ7c-23" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="706" y="4631" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-48" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5008187344199733;exitY=0.9956556701660156;entryX=0.4968399957779351;entryY=-0.002216494813257334;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-23" target="x1iQnE47CSqZXFiOeJ7c-24" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-49" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4968399957779351;exitY=0.9934104608029736;entryX=0.987069981438773;entryY=0.43061667955814353;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-24" target="x1iQnE47CSqZXFiOeJ7c-25" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="706" y="4887" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-50" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5004566192626954;exitY=0.9870843887329102;entryX=-0.005404506410871234;entryY=0.42673965809363196;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-12" target="x1iQnE47CSqZXFiOeJ7c-25" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-200" y="4887" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-51" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.500199454171317;exitY=0.9810064540189856;entryX=-0.005404506410871234;entryY=0.3526382500739975;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-18" target="x1iQnE47CSqZXFiOeJ7c-25" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="16" y="4887" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-52" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49994407238820604;exitY=0.9870843887329102;entryX=0.4908327375139509;entryY=0.010418387020335478;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-20" target="x1iQnE47CSqZXFiOeJ7c-25" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="x1iQnE47CSqZXFiOeJ7c-53" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.500046974701407;exitY=0.9870843887329102;entryX=0.987069981438773;entryY=0.37524826566228137;rounded=0;" parent="1" source="x1iQnE47CSqZXFiOeJ7c-22" target="x1iQnE47CSqZXFiOeJ7c-25" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="507" y="4887" />
            </Array>
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="HDK8y8DbsJZ6458C_AIx" name="phases.run">
    <mxGraphModel dx="1907" dy="1159" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-2" value="开始 Run 方法" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="1451" y="220" width="124" height="34" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-3" value="设置追踪&#xa;tracer.Start(&#39;run phases&#39;)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1417" y="304" width="191" height="50" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-4" value="初始化源层&#xa;sourceLayer := LayerResult{}" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1403" y="403" width="220" height="50" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-5" value="遍历所有构建器&#xa;for _, builder := range builders" style="rhombus;strokeWidth=2;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="1370" y="503" width="286" height="286" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-6" value="获取构建器元数据&#xa;meta := builder.Metadata()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="627" y="857" width="209" height="50" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-7" value="创建步骤日志记录器&#xa;stepUserLogger := userLogger.With(&#xa;phase, step_type, step_number, step)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="588" y="957" width="287" height="66" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-8" value="记录开始时间&#xa;phaseStartTime := time.Now()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="616" y="1072" width="232" height="50" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-9" value="计算哈希&#xa;hash, err := builder.Hash(ctx, sourceLayer)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="570" y="1172" width="322" height="50" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-10" value="返回错误&#xa;&#39;getting hash&#39;" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="260" y="2782" width="108" height="50" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-11" value="获取层&#xa;currentLayer, err :=&#xa;builder.Layer(ctx, sourceLayer, hash)" style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="679" y="1290" width="281" height="66" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-12" value="返回错误&#xa;&#39;getting layer&#39;" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="426" y="2782" width="112" height="50" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-13" value="记录缓存结果&#xa;metrics.RecordCacheResult()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="791" y="1424" width="222" height="50" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-14" value="获取前缀&#xa;prefix := builder.Prefix()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="808" y="1524" width="190" height="50" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-15" value="获取源字符串&#xa;source, err := builder.String(ctx)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="778" y="1642" width="248" height="50" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-16" value="返回错误&#xa;&#39;getting source&#39;" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="587" y="2782" width="122" height="50" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-17" value="记录日志&#xa;stepUserLogger.Info(&#xa;layerInfo(cached, prefix, source, hash))" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="855" y="1760" width="300" height="66" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-18" value="检查是否缓存命中&#xa;currentLayer.Cached?" style="rhombus;strokeWidth=2;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="896" y="1894" width="219" height="219" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-19" value="记录缓存阶段时长&#xa;phaseDuration := time.Since(phaseStartTime)&#xa;metrics.RecordPhaseDuration(cached=true)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="684" y="2182" width="341" height="66" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-20" value="更新源层&#xa;sourceLayer = currentLayer" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="748" y="2332" width="212" height="50" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-21" value="继续下一个&#xa;continue" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1150" y="2455" width="95" height="50" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-22" value="验证层&#xa;err = validateLayer(currentLayer)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1083" y="2190" width="256" height="50" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-23" value="返回错误&#xa;&#39;validating layer&#39;" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1033" y="2782" width="131" height="50" as="geometry" />
        </mxCell>
        <UserObject label="执行构建&#xa;res, err := builder.Build(&#xa;ctx, stepUserLogger, prefix,&#xa;sourceLayer, currentLayer)" link="data:page/id,XFOhNQ0H0sZA9kfUbB8c" id="WAFIEZUbzyAzmG6lTpwD-24">
          <mxCell style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
            <mxGeometry x="1358" y="2316" width="215" height="82" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-25" value="记录构建阶段时长&#xa;phaseDuration := time.Since(phaseStartTime)&#xa;metrics.RecordPhaseDuration(cached=false)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1295" y="2447" width="341" height="66" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-26" value="构建是否失败?" style="rhombus;strokeWidth=2;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="1391" y="2563" width="150" height="150" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-27" value="返回构建错误" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1312" y="2790" width="112" height="34" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-28" value="更新源层&#xa;sourceLayer = res" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1516" y="2782" width="140" height="50" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-29" value="返回最终层&#xa;return sourceLayer, nil" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1706" y="2782" width="177" height="50" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-30" value="结束" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="794" y="2881" width="56" height="34" as="geometry" />
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-31" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49626119675174835;exitY=0.9873950060676125;entryX=0.5001905151686743;entryY=-0.008571395874023438;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-2" target="WAFIEZUbzyAzmG6lTpwD-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-32" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5001905151686743;exitY=0.9828572082519531;entryX=0.4978926745328036;entryY=0.002857208251953125;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-3" target="WAFIEZUbzyAzmG6lTpwD-4" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-33" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4978926745328036;exitY=0.9942858123779297;entryX=0.49837898040984896;entryY=-0.0009989838500122925;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-4" target="WAFIEZUbzyAzmG6lTpwD-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-34" value="有下一个" style="curved=1;startArrow=none;endArrow=block;exitX=-0.0017251101407137785;exitY=0.6126112410117404;entryX=0.498997665478282;entryY=0.00690521240234375;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-5" target="WAFIEZUbzyAzmG6lTpwD-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="731" y="823" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-35" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.498997665478282;exitY=0.9983338165283203;entryX=0.4992700769510834;entryY=-0.001262260205817945;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-6" target="WAFIEZUbzyAzmG6lTpwD-7" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-36" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4992700769510834;exitY=0.9922442002729936;entryX=0.49694186243517646;entryY=0.009762344360351562;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-7" target="WAFIEZUbzyAzmG6lTpwD-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-37" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49694186243517646;exitY=1.0011909484863282;entryX=0.5009022114439781;entryY=0.001190948486328125;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-8" target="WAFIEZUbzyAzmG6lTpwD-9" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-38" value="失败" style="curved=1;startArrow=none;endArrow=block;exitX=0.0002528599330357143;exitY=0.9533464434246912;entryX=0.5002342506691262;entryY=-0.00246917724609375;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-9" target="WAFIEZUbzyAzmG6lTpwD-10" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="314" y="1256" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-39" value="成功" style="curved=1;startArrow=none;endArrow=block;exitX=0.6151827115515242;exitY=0.9926195526123047;entryX=0.4981900686895296;entryY=0.003066785407788826;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-9" target="WAFIEZUbzyAzmG6lTpwD-11" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="819" y="1256" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-40" value="失败" style="curved=1;startArrow=none;endArrow=block;exitX=-0.0014604453090246885;exitY=0.922777326645928;entryX=0.49687440054757254;entryY=-0.00246917724609375;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-11" target="WAFIEZUbzyAzmG6lTpwD-12" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="482" y="1390" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-41" value="成功" style="curved=1;startArrow=none;endArrow=block;exitX=0.6434418418159445;exitY=0.9965732458866003;entryX=0.5022085378835867;entryY=0.006905288696289063;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-11" target="WAFIEZUbzyAzmG6lTpwD-13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="902" y="1390" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-42" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5022085378835867;exitY=0.9983338928222656;entryX=0.4973173442639803;entryY=-0.001666107177734375;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-13" target="WAFIEZUbzyAzmG6lTpwD-14" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-43" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4973173442639803;exitY=0.9897624969482421;entryX=0.5019769976215978;entryY=0.00119110107421875;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-14" target="WAFIEZUbzyAzmG6lTpwD-15" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-44" value="失败" style="curved=1;startArrow=none;endArrow=block;exitX=0.0725030960710891;exitY=0.9926197052001953;entryX=0.505309058017418;entryY=-0.00246917724609375;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-15" target="WAFIEZUbzyAzmG6lTpwD-16" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="649" y="1726" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-45" value="成功" style="curved=1;startArrow=none;endArrow=block;exitX=0.675880448265726;exitY=0.9926197052001953;entryX=0.5009225209554037;entryY=0.003066901004675663;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-15" target="WAFIEZUbzyAzmG6lTpwD-17" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1005" y="1726" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-46" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5009225209554037;exitY=0.9965733614834872;rounded=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-17" target="WAFIEZUbzyAzmG6lTpwD-18" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
            <mxPoint x="1010" y="1890" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-47" value="是" style="curved=1;startArrow=none;endArrow=block;exitX=-0.0003025281374857306;exitY=0.9755932173860842;entryX=0.49918072384473516;entryY=-0.006019361091382576;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-18" target="WAFIEZUbzyAzmG6lTpwD-19" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="854" y="2147" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-48" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49918072384473516;exitY=0.987487099387429;entryX=0.5010406925993146;entryY=-0.005088386535644532;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-19" target="WAFIEZUbzyAzmG6lTpwD-20" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-49" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5010406925993146;exitY=0.9863402175903321;entryX=-0.00008874190481085526;entryY=0.3418843706346342;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-20" target="WAFIEZUbzyAzmG6lTpwD-21" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="854" y="2422" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-50" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1.0017157303659538;exitY=0.4117495259052521;entryX=0.9984830709604117;entryY=0.8006857762092203;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-21" target="WAFIEZUbzyAzmG6lTpwD-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1807" y="2422" />
              <mxPoint x="1807" y="823" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-51" value="否" style="curved=1;startArrow=none;endArrow=block;exitX=0.9982637727641623;exitY=0.850280741333833;entryX=0.49807024002075195;entryY=-0.007945594787597656;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-18" target="WAFIEZUbzyAzmG6lTpwD-22" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1211" y="2147" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-52" value="失败" style="curved=1;startArrow=none;endArrow=block;exitX=0.33696249625576513;exitY=0.983483009338379;entryX=0.5030436042610925;entryY=-0.00246917724609375;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-22" target="WAFIEZUbzyAzmG6lTpwD-23" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1099" y="2281" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-53" value="成功" style="curved=1;startArrow=none;endArrow=block;exitX=0.8665007121774968;exitY=0.983483009338379;entryX=0.5010972843613736;entryY=-0.003102697977205602;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-22" target="WAFIEZUbzyAzmG6lTpwD-24" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1466" y="2281" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-54" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5010972843613736;exitY=0.991670887644698;entryX=0.5006918361809247;entryY=0.0048032240434126424;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-24" target="WAFIEZUbzyAzmG6lTpwD-25" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-55" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5006918361809247;exitY=0.9983096845222242;entryX=0.49823944091796873;entryY=-0.0007437388102213542;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-25" target="WAFIEZUbzyAzmG6lTpwD-26" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-56" value="是" style="curved=1;startArrow=none;endArrow=block;exitX=0.0510316297096233;exitY=1.0020340728759765;entryX=0.5006608281816755;entryY=-0.003631143008961397;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-26" target="WAFIEZUbzyAzmG6lTpwD-27" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1368" y="2748" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-57" value="否" style="curved=1;startArrow=none;endArrow=block;exitX=0.9012891900649401;exitY=1.0020340728759765;entryX=0.40233126622568016;entryY=-0.00246917724609375;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-26" target="WAFIEZUbzyAzmG6lTpwD-28" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1554" y="2748" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-58" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.999771853855678;exitY=0.14877965562416648;entryX=0.9984830709604117;entryY=0.7814791452938343;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-28" target="WAFIEZUbzyAzmG6lTpwD-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1827" y="2748" />
              <mxPoint x="1827" y="823" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-59" value="无更多" style="curved=1;startArrow=none;endArrow=block;exitX=0.9984830709604117;exitY=0.8537495611452677;entryX=0.4245807161381836;entryY=-0.00246917724609375;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-5" target="WAFIEZUbzyAzmG6lTpwD-29" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1763" y="823" />
              <mxPoint x="1763" y="2748" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-60" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5004333021950587;exitY=0.9889594268798828;entryX=0.9937042849404472;entryY=0.4717624612578407;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-29" target="WAFIEZUbzyAzmG6lTpwD-30" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1795" y="2856" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-61" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5002342506691262;exitY=0.9889594268798828;entryX=0.0012297970908028738;entryY=0.43962108345791046;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-10" target="WAFIEZUbzyAzmG6lTpwD-30" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="314" y="2856" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-62" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49687440054757254;exitY=0.9889594268798828;entryX=0.0012297970908028738;entryY=0.406485200499433;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-12" target="WAFIEZUbzyAzmG6lTpwD-30" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="482" y="2856" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-63" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.505309058017418;exitY=0.9889594268798828;entryX=0.0012297970908028738;entryY=0.30969796397305477;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-16" target="WAFIEZUbzyAzmG6lTpwD-30" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="649" y="2856" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-64" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5030436042610925;exitY=0.9889594268798828;entryX=0.9937042849404472;entryY=0.3835958767953985;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-23" target="WAFIEZUbzyAzmG6lTpwD-30" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1099" y="2856" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WAFIEZUbzyAzmG6lTpwD-65" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5006608281816755;exitY=0.9837638630586512;entryX=0.9937042849404472;entryY=0.44434693590368196;rounded=0;" parent="1" source="WAFIEZUbzyAzmG6lTpwD-27" target="WAFIEZUbzyAzmG6lTpwD-30" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1368" y="2856" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="lCsKLjsDrSIR6Tp-syrX-1" value="&lt;ul style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; margin: 0px 0px 0px 16px; color: rgb(197, 200, 198); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(39, 39, 39); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; padding: 0px;&quot;&gt;&lt;li data-indent=&quot;0&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; margin-bottom: 2px !important; margin-top: 2px !important; margin-left: 0px; padding-top: 2px; padding-bottom: 2px; list-style-type: disc;&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;根&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;据源&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;层和&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;哈希值确&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;定当&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;前层的&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;状态&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;ul style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(197, 200, 198); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(39, 39, 39); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; margin: 0px 0px 0px 16px; padding: 0px;&quot;&gt;&lt;li data-indent=&quot;0&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; margin-bottom: 2px !important; margin-top: 2px !important; margin-left: 0px; padding-top: 2px; padding-bottom: 2px; list-style-type: disc;&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;检查&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;缓存中是否已&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;存&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;在该层&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;（避免重复构建&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;）&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;ul style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; margin: 0px 0px 0px 16px; color: rgb(197, 200, 198); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(39, 39, 39); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; padding: 0px;&quot;&gt;&lt;li data-indent=&quot;0&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; margin-bottom: 2px !important; margin-top: 2px !important; margin-left: 0px; padding-top: 2px; padding-bottom: 2px; list-style-type: disc;&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;返回&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;&lt;span&gt;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;markdown-inline-code leading-[1.4]&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; line-height: 1.4; background-color: color(srgb 0.220896 0.220896 0.220896 / 0.420392); border-radius: 4px; color: inherit; font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.9em; padding: 1.5px 3px; transition: 0.1s; word-break: break-all; cursor: default;&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;LayerResult&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;，包含层的元数据&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;、缓存状态和&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;哈希值&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="980" y="1290" width="380" height="90" as="geometry" />
        </mxCell>
        <mxCell id="vPOgfMjzaM6B2AC_9OGv-1" value="finalize层没有缓存，永远需要构建" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1360" y="1320" width="210" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="XFOhNQ0H0sZA9kfUbB8c" name="BuilderPhase.build">
    <mxGraphModel dx="2162" dy="811" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="UZ5FKT6LPgw2XRQqxE_m-1" value="空层" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry y="194" width="47" height="34" as="geometry" />
        </mxCell>
        <UserObject label="Base 层" link="data:page/id,eRVU4kPgmjjhjabjWr-B" id="UZ5FKT6LPgw2XRQqxE_m-2">
          <mxCell style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
            <mxGeometry x="151" y="194" width="69" height="34" as="geometry" />
          </mxCell>
        </UserObject>
        <UserObject label="User 层" link="data:page/id,ixt1B0D9xi53rm6hGKQD" id="UZ5FKT6LPgw2XRQqxE_m-3">
          <mxCell style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
            <mxGeometry x="339" y="152" width="68" height="34" as="geometry" />
          </mxCell>
        </UserObject>
        <UserObject label="Step1 层" link="data:page/id,kmTGZt_N8BzOqGan6cGm" id="UZ5FKT6LPgw2XRQqxE_m-4">
          <mxCell style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
            <mxGeometry x="528" y="110" width="76" height="34" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="UZ5FKT6LPgw2XRQqxE_m-5" value="Step2 层" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="710" y="110" width="76" height="34" as="geometry" />
        </mxCell>
        <mxCell id="UZ5FKT6LPgw2XRQqxE_m-6" value="Finalize 层（PostProcessingBuilder）" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="890" y="110" width="150" height="34" as="geometry" />
        </mxCell>
        <mxCell id="UZ5FKT6LPgw2XRQqxE_m-7" value="跳过构建" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="334" y="235" width="79" height="34" as="geometry" />
        </mxCell>
        <mxCell id="UZ5FKT6LPgw2XRQqxE_m-8" value="跳过构建" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="527" y="194" width="79" height="34" as="geometry" />
        </mxCell>
        <mxCell id="UZ5FKT6LPgw2XRQqxE_m-9" value="Phase 1" style="curved=1;startArrow=none;endArrow=block;exitX=1.0039513770570145;exitY=0.4810925091014189;entryX=-0.00136295263318048;entryY=0.4810925091014189;rounded=0;" parent="1" source="UZ5FKT6LPgw2XRQqxE_m-1" target="UZ5FKT6LPgw2XRQqxE_m-2" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="UZ5FKT6LPgw2XRQqxE_m-10" value="Phase 2" style="curved=1;startArrow=none;endArrow=block;exitX=0.9937627488288326;exitY=0.019081773914720657;entryX=0.003638940698960248;entryY=0.4873950060676126;rounded=0;" parent="1" source="UZ5FKT6LPgw2XRQqxE_m-2" target="UZ5FKT6LPgw2XRQqxE_m-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="277" y="169" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="UZ5FKT6LPgw2XRQqxE_m-11" value="Phase 3" style="curved=1;startArrow=none;endArrow=block;exitX=1.0006500131943648;exitY=0.056043845540476325;entryX=0.003634904560289885;entryY=0.4936975030338063;rounded=0;" parent="1" source="UZ5FKT6LPgw2XRQqxE_m-3" target="UZ5FKT6LPgw2XRQqxE_m-4" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="470" y="127" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="UZ5FKT6LPgw2XRQqxE_m-12" value="Phase 4" style="curved=1;startArrow=none;endArrow=block;exitX=1.0045260379188938;exitY=0.4936975030338063;entryX=-0.0026331449809827304;entryY=0.4936975030338063;rounded=0;" parent="1" source="UZ5FKT6LPgw2XRQqxE_m-4" target="UZ5FKT6LPgw2XRQqxE_m-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="UZ5FKT6LPgw2XRQqxE_m-13" value="Phase 5" style="curved=1;startArrow=none;endArrow=block;exitX=0.9982579883776213;exitY=0.4936975030338063;entryX=-0.004479905833368716;entryY=0.4936975030338063;rounded=0;" parent="1" source="UZ5FKT6LPgw2XRQqxE_m-5" target="UZ5FKT6LPgw2XRQqxE_m-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="UZ5FKT6LPgw2XRQqxE_m-14" value="缓存命中" style="curved=1;dashed=1;dashPattern=2 3;startArrow=none;endArrow=block;exitX=0.9937627488288326;exitY=0.9431032442881171;entryX=-0.0055983821048012266;entryY=0.5042017768411076;rounded=0;" parent="1" source="UZ5FKT6LPgw2XRQqxE_m-2" target="UZ5FKT6LPgw2XRQqxE_m-7" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="277" y="252" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="UZ5FKT6LPgw2XRQqxE_m-15" value="缓存命中" style="curved=1;dashed=1;dashPattern=2 3;startArrow=none;endArrow=block;exitX=1.0006500131943648;exitY=0.9187461665947488;entryX=-0.003518744360042524;entryY=0.4810925091014189;rounded=0;" parent="1" source="UZ5FKT6LPgw2XRQqxE_m-3" target="UZ5FKT6LPgw2XRQqxE_m-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="470" y="210" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="UZ5FKT6LPgw2XRQqxE_m-16" value="&lt;div style=&quot;color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #aaaaaa;font-style: italic;&quot;&gt;&amp;nbsp; &amp;nbsp; // phase.go文件&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #aaaaaa;font-style: italic;&quot;&gt;&amp;nbsp; &amp;nbsp; // Construct the phases/steps to run&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #333333;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;builders&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;:=&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;[]&lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;font-weight: bold;&quot;&gt;phases&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;font-weight: bold;&quot;&gt;BuilderPhase&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #333333;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;baseBuilder&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #333333;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ...&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #333333;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #4b69c6;&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;ok&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #333333;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;builders&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #aa3731;font-weight: bold;&quot;&gt;append&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;builders&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;userBuilder&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #333333;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #333333;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;builders&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #aa3731;font-weight: bold;&quot;&gt;append&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;builders&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;stepBuilders&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;...)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #333333;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;builders&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #aa3731;font-weight: bold;&quot;&gt;append&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;builders&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;postProcessingBuilder&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="46" y="360" width="434" height="230" as="geometry" />
        </mxCell>
        <mxCell id="WU8G0GjTKnhWyR9a10g_-1" value="&lt;div style=&quot;color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px;&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #4b69c6;&quot;&gt;type&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;font-weight: bold;&quot;&gt;UserBuilder&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #4b69c6;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #333333;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;font-weight: bold;&quot;&gt;steps&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;font-weight: bold;&quot;&gt;StepBuilder&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #333333;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;user&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;string&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #777777;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1654" y="20" width="230" height="140" as="geometry" />
        </mxCell>
        <mxCell id="rTiQJHn774aSHXKluoY2-4" value="&lt;span style=&quot;border-color: var(--border-color); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;从&lt;/span&gt;&lt;span style=&quot;border-color: var(--border-color); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;&lt;span style=&quot;border-color: var(--border-color);&quot;&gt;&amp;nbsp;&lt;/span&gt;OCI&lt;/span&gt;&lt;span style=&quot;border-color: var(--border-color); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;&lt;span style=&quot;border-color: var(--border-color);&quot;&gt;&amp;nbsp;&lt;/span&gt;镜像构建基础层&lt;/span&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="100" y="290" width="170" height="40" as="geometry" />
        </mxCell>
        <mxCell id="rTiQJHn774aSHXKluoY2-5" value="&lt;span style=&quot;border-color: var(--border-color); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;处&lt;/span&gt;&lt;span style=&quot;border-color: var(--border-color); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;理用户相&lt;/span&gt;&lt;span style=&quot;border-color: var(--border-color); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;关的构建&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;border-color: var(--border-color); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;（复&lt;/span&gt;&lt;span style=&quot;border-color: var(--border-color); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;用&lt;/span&gt;&lt;span style=&quot;border-color: var(--border-color); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;了&lt;/span&gt;&lt;span style=&quot;border-color: var(--border-color); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;&lt;span style=&quot;border-color: var(--border-color);&quot;&gt;&amp;nbsp;&lt;/span&gt;StepBuilder 的实&lt;/span&gt;&lt;span style=&quot;border-color: var(--border-color); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;现&lt;/span&gt;&lt;span style=&quot;border-color: var(--border-color); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;）&lt;/span&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="270" y="90" width="190" height="40" as="geometry" />
        </mxCell>
        <mxCell id="rTiQJHn774aSHXKluoY2-6" value="&lt;span style=&quot;border-color: var(--border-color); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;执&lt;/span&gt;&lt;span style=&quot;border-color: var(--border-color); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;行用&lt;/span&gt;&lt;span style=&quot;border-color: var(--border-color); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;户定义的构&lt;/span&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="520" y="70" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="rTiQJHn774aSHXKluoY2-7" value="&lt;span style=&quot;border-color: var(--border-color); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;执行最终的后&lt;/span&gt;&lt;span style=&quot;border-color: var(--border-color); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;处理操作（配&lt;/span&gt;&lt;span style=&quot;border-color: var(--border-color); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;置&lt;/span&gt;&lt;span style=&quot;border-color: var(--border-color); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;、启&lt;/span&gt;&lt;span style=&quot;border-color: var(--border-color); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;动命令等）&lt;/span&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="820" y="186" width="290" height="40" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="jrMp-D_WtmVrWmC2ec3N" name="BaseBuilder.Layer">
    <mxGraphModel dx="1907" dy="1159" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="iZYh_c9IXsheVTeW2bRX-1" value="开始 Layer 方法" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="593" y="20" width="138" height="39" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-2" value="设置追踪&#xa;tracer.Start(&#39;compute base&#39;)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="532" y="109" width="259" height="78" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-3" value="检查构建源&#xa;FromTemplate != nil?" style="rhombus;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="548" y="237" width="229" height="229" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-4" value="从模板构建分支" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="64" y="2022" width="172" height="54" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-5" value="从镜像构建分支" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="709" y="540" width="172" height="54" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-6" value="创建源元数据&#xa;sourceMeta = FromTemplate{&#xa;  Alias, BuildID&#xa;}" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="20" y="2162" width="260" height="126" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-7" value="从缓存获取模板&#xa;bb.index.Cached(buildID)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="29" y="2362" width="243" height="78" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-8" value="返回当前层已缓存&#xa;LayerResult{&#xa;  Metadata: tm.BasedOn(sourceMeta),&#xa;  Hash: hash,&#xa;  Cached: true&#xa;}" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="20" y="2490" width="260" height="174" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-9" value="创建命令元数据&#xa;cmdMeta = Context{&#xa;  User: defaultUser,&#xa;  WorkDir: nil,&#xa;  EnvVars: {}&#xa;}" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="692" y="644" width="205" height="174" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-10" value="V1 版本?&#xa;bb.IsV1Build" style="rhombus;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="712" y="868" width="166" height="166" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-11" value="设置工作目录&#xa;WorkDir = &#39;/home/user&#39;" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="760" y="1108" width="226" height="78" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-12" value="创建模板元数据&#xa;meta = Template{&#xa;  Version,&#xa;  BuildID: uuid.New(),&#xa;  KernelVersion,&#xa;  FirecrackerVersion,&#xa;  Context: cmdMeta,&#xa;  FromImage&#xa;}" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="692" y="1236" width="206" height="246" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-13" value="创建结果&lt;br&gt;notCachedResult = LayerResult{&lt;br&gt;  Metadata: meta,&lt;br&gt;  Cached: false,&lt;br&gt;  Hash: hash&lt;br&gt;}" style="whiteSpace=wrap;strokeWidth=2;html=1;" vertex="1" parent="1">
          <mxGeometry x="665" y="1532" width="260" height="174" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-14" value="检查强制重建&#xa;Force == true?" style="rhombus;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="705" y="1756" width="180" height="180" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-15" value="返回当前层未缓存" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="330" y="2538" width="172" height="78" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-16" value="查找哈希对应的层&#xa;bb.index.LayerMetaFromHash(hash)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="776" y="2010" width="260" height="78" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-17" value="记录日志&#xa;&#39;base layer not found in cache&#39;" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="508" y="2362" width="260" height="78" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-18" value="返回当前层未缓存" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="552" y="2538" width="172" height="78" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-19" value="获取元数据&#xa;bb.index.Cached(bm.Template.BuildID)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="931" y="2186" width="260" height="78" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-20" value="记录日志&#xa;&#39;metadata not found in cache&#39;" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="818" y="2362" width="260" height="78" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-21" value="返回当前层未缓存" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="862" y="2538" width="172" height="78" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-22" value="返回当前层已缓存&#xa;LayerResult{&#xa;  Metadata: meta,&#xa;  Cached: true,&#xa;  Hash: hash&#xa;}" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1084" y="2490" width="180" height="174" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-23" value="结束" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="610" y="2714" width="57" height="39" as="geometry" />
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-24" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-1" target="iZYh_c9IXsheVTeW2bRX-2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-25" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-2" target="iZYh_c9IXsheVTeW2bRX-3">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-26" value="是" style="curved=1;startArrow=none;endArrow=block;exitX=0;exitY=0.65;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-3" target="iZYh_c9IXsheVTeW2bRX-4">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="150" y="503" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-27" value="否" style="curved=1;startArrow=none;endArrow=block;exitX=0.94;exitY=1;entryX=0.5;entryY=-0.01;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-3" target="iZYh_c9IXsheVTeW2bRX-5">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="795" y="503" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-28" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-4" target="iZYh_c9IXsheVTeW2bRX-6">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-29" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-6" target="iZYh_c9IXsheVTeW2bRX-7">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-30" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-7" target="iZYh_c9IXsheVTeW2bRX-8">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-31" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=0.99;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-5" target="iZYh_c9IXsheVTeW2bRX-9">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-32" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-9" target="iZYh_c9IXsheVTeW2bRX-10">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-33" value="是" style="curved=1;startArrow=none;endArrow=block;exitX=0.82;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-10" target="iZYh_c9IXsheVTeW2bRX-11">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="873" y="1071" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-34" value="否" style="curved=1;startArrow=none;endArrow=block;exitX=0;exitY=0.62;entryX=0;entryY=0.37;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-10" target="iZYh_c9IXsheVTeW2bRX-12">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="301" y="1071" />
              <mxPoint x="301" y="1211" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-35" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.81;entryY=0;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-11" target="iZYh_c9IXsheVTeW2bRX-12">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="873" y="1211" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-36" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-12" target="iZYh_c9IXsheVTeW2bRX-13">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-37" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-13" target="iZYh_c9IXsheVTeW2bRX-14">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-38" value="是" style="curved=1;startArrow=none;endArrow=block;exitX=0;exitY=0.67;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-14" target="iZYh_c9IXsheVTeW2bRX-15">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="416" y="1973" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-39" value="否" style="curved=1;startArrow=none;endArrow=block;exitX=0.94;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-14" target="iZYh_c9IXsheVTeW2bRX-16">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="906" y="1973" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-40" value="未找到" style="curved=1;startArrow=none;endArrow=block;exitX=0;exitY=0.97;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-16" target="iZYh_c9IXsheVTeW2bRX-17">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="638" y="2125" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-41" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-17" target="iZYh_c9IXsheVTeW2bRX-18">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-42" value="找到" style="curved=1;startArrow=none;endArrow=block;exitX=0.81;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-16" target="iZYh_c9IXsheVTeW2bRX-19">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1061" y="2125" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-43" value="失败" style="curved=1;startArrow=none;endArrow=block;exitX=0.33;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-19" target="iZYh_c9IXsheVTeW2bRX-20">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="948" y="2325" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-44" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-20" target="iZYh_c9IXsheVTeW2bRX-21">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-45" value="成功" style="curved=1;startArrow=none;endArrow=block;exitX=0.67;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-19" target="iZYh_c9IXsheVTeW2bRX-22">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1174" y="2325" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-46" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=-0.01;entryY=0.43;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-8" target="iZYh_c9IXsheVTeW2bRX-23">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="150" y="2689" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-47" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=-0.01;entryY=0.35;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-15" target="iZYh_c9IXsheVTeW2bRX-23">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="416" y="2689" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-48" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.49;entryY=0;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-18" target="iZYh_c9IXsheVTeW2bRX-23">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-49" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.99;entryY=0.39;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-21" target="iZYh_c9IXsheVTeW2bRX-23">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="948" y="2689" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="iZYh_c9IXsheVTeW2bRX-50" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.99;entryY=0.44;rounded=0;" edge="1" parent="1" source="iZYh_c9IXsheVTeW2bRX-22" target="iZYh_c9IXsheVTeW2bRX-23">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1174" y="2689" />
            </Array>
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="eRVU4kPgmjjhjabjWr-B" name="BaseBuilder.Build">
    <mxGraphModel dx="1335" dy="1980" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="oXAUiLyRjAdZLISyz3wm-1" value="开始 BaseBuilder.Build" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="997" y="-87" width="184" height="34" as="geometry" />
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-2" value="设置追踪&#xa;tracer.Start(&#39;build base&#39;)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="995" y="-3" width="188" height="50" as="geometry" />
        </mxCell>
        <mxCell id="KzIsGBu2hX0mD8F8vOri-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;curved=1;dashed=1;" parent="1" source="oXAUiLyRjAdZLISyz3wm-3" target="oXAUiLyRjAdZLISyz3wm-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-3" value="调用 buildLayerFromOCI" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="994" y="96" width="188" height="34" as="geometry" />
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-4" value="返回层结果&#xa;LayerResult{Metadata, Cached: false}" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="810" y="180" width="285" height="50" as="geometry" />
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-5" value="结束" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="924" y="287" width="56" height="34" as="geometry" />
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-6" value="buildLayerFromOCI" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="1391" y="180" width="160" height="34" as="geometry" />
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-7" value="创建构建目录&#xa;os.MkdirAll()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1415" y="271" width="111" height="50" as="geometry" />
        </mxCell>
        <mxCell id="KzIsGBu2hX0mD8F8vOri-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;curved=1;dashed=1;" parent="1" source="oXAUiLyRjAdZLISyz3wm-8" target="nTh_WmzemqS4eG_-H5sX-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-8" value="从 OCI 构建层文件&#xa;constructLayerFilesFromOCI()&#xa;(rootfs, memfile, envsImg)" style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="1357" y="371" width="228" height="66" as="geometry" />
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-9" value="解析环境变量&#xa;oci.ParseEnvs()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1409" y="486" width="123" height="50" as="geometry" />
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-10" value="创建本地模板&#xa;NewLocalTemplate()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1390" y="586" width="162" height="50" as="geometry" />
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-11" value="创建 rootfs 符号链接&#xa;os.Symlink()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1389" y="686" width="163" height="50" as="geometry" />
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-12" value="创建沙箱配置&#xa;允许互联网访问" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1407" y="785" width="127" height="50" as="geometry" />
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-13" value="Provision 沙箱&#xa;bb.provisionSandbox()&#xa;(安装 systemd 等)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1383" y="885" width="174" height="66" as="geometry" />
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-14" value="检查文件系统完整性&#xa;filesystem.CheckIntegrity()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1365" y="1000" width="210" height="50" as="geometry" />
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-15" value="扩展磁盘&#xa;enlargeDiskAfterProvisioning()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1355" y="1100" width="231" height="50" as="geometry" />
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-16" value="创建沙箱创建器&#xa;NewCreateSandboxFromCache()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1348" y="1199" width="245" height="50" as="geometry" />
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-17" value="创建动作执行器&#xa;NewFunctionAction(SyncChangesToDisk)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1320" y="1299" width="301" height="50" as="geometry" />
        </mxCell>
        <UserObject label="执行层构建&#xa;layerExecutor.BuildLayer()" link="data:page/id,wNZgj8RMV-2R5AmFV6Rv" id="oXAUiLyRjAdZLISyz3wm-18">
          <mxCell style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
            <mxGeometry x="1368" y="1399" width="205" height="50" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-19" value="返回基础层" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1423" y="1498" width="95" height="34" as="geometry" />
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-20" value="结束" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1443" y="1582" width="56" height="34" as="geometry" />
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-21" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4963970598967179;exitY=0.9873950060676125;entryX=0.4964737181967877;entryY=-0.008571395874023438;rounded=0;" parent="1" source="oXAUiLyRjAdZLISyz3wm-1" target="oXAUiLyRjAdZLISyz3wm-2" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-22" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4964737181967877;exitY=0.9828572082519531;entryX=0.5017928671329579;entryY=0.004201776841107537;rounded=0;" parent="1" source="oXAUiLyRjAdZLISyz3wm-2" target="oXAUiLyRjAdZLISyz3wm-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-23" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.21101014212162542;exitY=0.9915967829087201;entryX=0.4991254304584704;entryY=-0.005714187622070313;rounded=0;" parent="1" source="oXAUiLyRjAdZLISyz3wm-3" target="oXAUiLyRjAdZLISyz3wm-4" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="952" y="155" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-24" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4991254304584704;exitY=0.9857144165039062;entryX=0.5044776371547154;entryY=0.008403553682215074;rounded=0;" parent="1" source="oXAUiLyRjAdZLISyz3wm-4" target="oXAUiLyRjAdZLISyz3wm-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-26" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4963960647583008;exitY=0.9789917889763328;entryX=0.49930964289484797;entryY=0.00571441650390625;rounded=0;" parent="1" source="oXAUiLyRjAdZLISyz3wm-6" target="oXAUiLyRjAdZLISyz3wm-7" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-27" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49930964289484797;exitY=0.9971430206298828;entryX=0.49747092263740406;entryY=-0.002164378310694839;rounded=0;" parent="1" source="oXAUiLyRjAdZLISyz3wm-7" target="oXAUiLyRjAdZLISyz3wm-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-28" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49747092263740406;exitY=0.9913420821681167;entryX=0.4993769948075457;entryY=0.008571548461914063;rounded=0;" parent="1" source="oXAUiLyRjAdZLISyz3wm-8" target="oXAUiLyRjAdZLISyz3wm-9" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-29" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4993769948075457;exitY=1.0000001525878905;entryX=0.49644055778597607;entryY=1.52587890625e-7;rounded=0;" parent="1" source="oXAUiLyRjAdZLISyz3wm-9" target="oXAUiLyRjAdZLISyz3wm-10" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-30" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49644055778597607;exitY=0.9914287567138672;entryX=0.49952987951735045;entryY=-0.008571243286132813;rounded=0;" parent="1" source="oXAUiLyRjAdZLISyz3wm-10" target="oXAUiLyRjAdZLISyz3wm-11" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-31" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49952987951735045;exitY=0.9828573608398438;entryX=0.4993966170183317;entryY=0.00285736083984375;rounded=0;" parent="1" source="oXAUiLyRjAdZLISyz3wm-11" target="oXAUiLyRjAdZLISyz3wm-12" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-32" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4993966170183317;exitY=0.9942859649658203;entryX=0.5024331629961386;entryY=-0.0043288144198330965;rounded=0;" parent="1" source="oXAUiLyRjAdZLISyz3wm-12" target="oXAUiLyRjAdZLISyz3wm-13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-33" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5024331629961386;exitY=0.9891776460589785;entryX=0.5020160493396577;entryY=0.005714492797851562;rounded=0;" parent="1" source="oXAUiLyRjAdZLISyz3wm-13" target="oXAUiLyRjAdZLISyz3wm-14" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-34" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5020160493396577;exitY=0.9971430969238281;entryX=0.4996682699624594;entryY=-0.002856903076171875;rounded=0;" parent="1" source="oXAUiLyRjAdZLISyz3wm-14" target="oXAUiLyRjAdZLISyz3wm-15" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-35" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4996682699624594;exitY=0.9885717010498047;entryX=0.4996872259646046;entryY=0.008571701049804687;rounded=0;" parent="1" source="oXAUiLyRjAdZLISyz3wm-15" target="oXAUiLyRjAdZLISyz3wm-16" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-36" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4996872259646046;exitY=1.0000003051757813;entryX=0.4997454164828177;entryY=3.0517578125e-7;rounded=0;" parent="1" source="oXAUiLyRjAdZLISyz3wm-16" target="oXAUiLyRjAdZLISyz3wm-17" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-37" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4997454164828177;exitY=0.9914289093017579;entryX=0.4996261968845274;entryY=-0.008571090698242188;rounded=0;" parent="1" source="oXAUiLyRjAdZLISyz3wm-17" target="oXAUiLyRjAdZLISyz3wm-18" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-38" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4996261968845274;exitY=0.9828575134277344;entryX=0.4991933722245066;entryY=0.004202225629021139;rounded=0;" parent="1" source="oXAUiLyRjAdZLISyz3wm-18" target="oXAUiLyRjAdZLISyz3wm-19" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="oXAUiLyRjAdZLISyz3wm-39" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4991933722245066;exitY=0.9915972316966337;entryX=0.4897030421665737;entryY=-0.008402768303366268;rounded=0;" parent="1" source="oXAUiLyRjAdZLISyz3wm-19" target="oXAUiLyRjAdZLISyz3wm-20" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <UserObject label="开始 constructLayerFilesFromOCI" linkTarget="_blank" id="nTh_WmzemqS4eG_-H5sX-2">
          <mxCell style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
            <mxGeometry x="1840" y="540" width="261" height="34" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-3" value="设置追踪&#xa;tracer.Start(&#39;template-build&#39;)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1860" y="624" width="222" height="50" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-4" value="创建 rootfs 对象&#xa;rtfs := rootfs.New(&#xa;  artifactRegistry,&#xa;  dockerhubRepository,&#xa;  template, config)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1886" y="723" width="169" height="98" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-5" value="获取 provision 脚本&#xa;getProvisionScript()" style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="1893" y="871" width="156" height="50" as="geometry" />
        </mxCell>
        <mxCell id="KzIsGBu2hX0mD8F8vOri-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;curved=1;dashed=1;" parent="1" source="nTh_WmzemqS4eG_-H5sX-6" target="nTh_WmzemqS4eG_-H5sX-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <UserObject label="创建 ext4 文件系统&#xa;rtfs.CreateExt4Filesystem()&#xa;(从 OCI 镜像提取并创建文件系统)" link="https://github.com/hejunyi-cmcccit/25H2-E2B/blob/main/Orchestrator/CmuxServer/grpc/template/Base/Rootfs.CreateExt4Filesystem.md" id="nTh_WmzemqS4eG_-H5sX-6">
          <mxCell style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
            <mxGeometry x="1844" y="970" width="253" height="66" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-7" value="解析 build ID&#xa;uuid.Parse(baseBuildID)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1878" y="1086" width="184" height="50" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-8" value="创建 rootfs block&#xa;block.NewLocal(rootfsPath)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1864" y="1185" width="213" height="50" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-9" value="创建空 memfile&#xa;block.NewEmpty(&#xa;  MemoryMB, PageSize, buildID)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1855" y="1285" width="231" height="66" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-10" value="返回结果&#xa;return rootfs, memfile, imgConfig" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1841" y="1401" width="259" height="50" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-11" value="结束" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="1943" y="1500" width="56" height="34" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-12" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4999230629639607;exitY=0.9873950060676125;entryX=0.4976572947459178;entryY=-0.008571395874023438;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-2" target="nTh_WmzemqS4eG_-H5sX-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-13" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4976572947459178;exitY=0.9828572082519531;entryX=0.4998811800804364;entryY=0.0014577593122209822;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-3" target="nTh_WmzemqS4eG_-H5sX-4" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-14" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4998811800804364;exitY=0.9970847149284519;entryX=0.49666615021534455;entryY=-0.005713958740234375;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-4" target="nTh_WmzemqS4eG_-H5sX-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-15" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49666615021534455;exitY=0.9857146453857422;entryX=0.4999206301723073;entryY=0.0043292768073804454;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-5" target="nTh_WmzemqS4eG_-H5sX-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-16" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4999206301723073;exitY=0.997835737286192;entryX=0.5026082577912704;entryY=-0.0028568267822265624;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-6" target="nTh_WmzemqS4eG_-H5sX-7" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-17" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5026082577912704;exitY=0.98857177734375;entryX=0.49990572504034625;entryY=0.00857177734375;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-7" target="nTh_WmzemqS4eG_-H5sX-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-18" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49990572504034625;exitY=1.0000003814697265;entryX=0.4999130711410985;entryY=2.8899221709280304e-7;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-8" target="nTh_WmzemqS4eG_-H5sX-9" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-19" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4999130711410985;exitY=0.9935067494710287;entryX=0.49992246885557434;entryY=-0.008571090698242188;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-9" target="nTh_WmzemqS4eG_-H5sX-10" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-20" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49992246885557434;exitY=0.9828575134277344;entryX=0.4907128470284598;entryY=0.004202225629021139;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-10" target="nTh_WmzemqS4eG_-H5sX-11" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <UserObject label="开始 CreateExt4Filesystem" link="TemplateService/Rootfs.CreateExt4Filesystem().md" id="nTh_WmzemqS4eG_-H5sX-22">
          <mxCell style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
            <mxGeometry x="2450" y="1070" width="215" height="34" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-23" value="设置追踪&#xa;tracer.Start(&#39;create-ext4-file&#39;)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="2444" y="1154" width="228" height="50" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-24" value="记录日志&#xa;&#39;Requesting Docker Image&#39;" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="2458" y="1253" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-25" value="镜像来源" style="rhombus;strokeWidth=2;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="2502" y="1353" width="113" height="113" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-26" value="获取公共镜像&#xa;oci.GetPublicImage(&#xa;  dockerhub, fromImage)" style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="2340" y="1534" width="184" height="66" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-27" value="获取私有镜像&#xa;oci.GetImage(&#xa;  artifactRegistry, templateID)" style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="2574" y="1534" width="221" height="66" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-28" value="获取镜像大小&#xa;oci.GetImageSize()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="2482" y="1650" width="152" height="50" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-29" value="记录镜像大小&#xa;&#39;Base Docker image size: XX&#39;" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="2450" y="1749" width="215" height="50" as="geometry" />
        </mxCell>
        <UserObject label="创建额外 OCI 层&#xa;additionalOCILayers()&#xa;(systemd, envd, provision 脚本等)" link="https://github.com/hejunyi-cmcccit/25H2-E2B/blob/main/Orchestrator/CmuxServer/grpc/template/Base/additionalOCILayers.md" id="nTh_WmzemqS4eG_-H5sX-30">
          <mxCell style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
            <mxGeometry x="2429" y="1849" width="258" height="66" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-31" value="追加层到镜像&#xa;mutate.AppendLayers(img, layers...)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="2418" y="1964" width="280" height="50" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-32" value="记录日志&#xa;&#39;Creating file system and pulling&#xa;Docker image&#39;" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="2435" y="2064" width="245" height="66" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-33" value="转换为 ext4 文件系统&#xa;oci.ToExt4(img, rootfsPath)" style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="2452" y="2179" width="211" height="50" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-34" value="使文件系统可写&#xa;filesystem.MakeWritable()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="2457" y="2279" width="203" height="50" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-35" value="获取可用空间&#xa;filesystem.GetFreeSpace()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="2455" y="2379" width="206" height="50" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-36" value="计算需要添加的大小&#xa;diskAdd = DiskSizeMB - freeSpace" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="2432" y="2478" width="253" height="50" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-37" value="diskAdd &gt; 0?" style="rhombus;strokeWidth=2;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="2490" y="2578" width="136" height="136" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-38" value="扩展文件系统&#xa;filesystem.Enlarge(rootfsPath, diskAdd)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="2505" y="2782" width="299" height="50" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-39" value="检查文件系统完整性&#xa;filesystem.CheckIntegrity()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="2453" y="2882" width="210" height="50" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-40" value="获取镜像配置&#xa;img.ConfigFile()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="2493" y="2982" width="131" height="50" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-41" value="返回配置&#xa;return config.Config" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="2478" y="3081" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-42" value="结束" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="2530" y="3181" width="56" height="34" as="geometry" />
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-43" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5023274089014808;exitY=0.9873950060676125;entryX=0.5000017233062208;entryY=-0.008571395874023438;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-22" target="nTh_WmzemqS4eG_-H5sX-23" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-44" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5000017233062208;exitY=0.9828572082519531;entryX=0.5000019645690919;entryY=0.002857208251953125;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-23" target="nTh_WmzemqS4eG_-H5sX-24" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-45" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5000019645690919;exitY=0.9942858123779297;entryX=0.49557869835237484;entryY=-0.002528401602685979;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-24" target="nTh_WmzemqS4eG_-H5sX-25" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-46" value="FromImage" style="curved=1;startArrow=none;endArrow=block;exitX=-0.003304608100283462;exitY=0.8549334575307319;entryX=0.4992802661398183;entryY=0.0005052739923650569;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-25" target="nTh_WmzemqS4eG_-H5sX-26" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2432" y="1500" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-47" value="FromTemplate" style="curved=1;startArrow=none;endArrow=block;exitX=0.9944620048050332;exitY=0.8549334575307319;entryX=0.4983403477733491;entryY=0.0005052739923650569;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-25" target="nTh_WmzemqS4eG_-H5sX-27" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2684" y="1500" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-48" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4992802661398183;exitY=0.9940117344711766;entryX=0.08687781495400658;entryY=-0.007904510498046875;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-26" target="nTh_WmzemqS4eG_-H5sX-28" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2432" y="1625" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-49" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4983403477733491;exitY=0.9940117344711766;entryX=0.913127354964656;entryY=-0.007904510498046875;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-27" target="nTh_WmzemqS4eG_-H5sX-28" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2684" y="1625" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-50" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5000025849593314;exitY=0.9835240936279297;entryX=0.5023274089014808;entryY=0.0035240936279296877;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-28" target="nTh_WmzemqS4eG_-H5sX-29" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-51" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5023274089014808;exitY=0.9949526977539063;entryX=0.5000015229217766;entryY=-0.0038237138227982955;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-29" target="nTh_WmzemqS4eG_-H5sX-30" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-52" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5000015229217766;exitY=0.9896827466560133;entryX=0.500001403263637;entryY=0.0063812255859375;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-30" target="nTh_WmzemqS4eG_-H5sX-31" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-53" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.500001403263637;exitY=0.997809829711914;entryX=0.5020424200564014;entryY=-0.0016592199152166193;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-31" target="nTh_WmzemqS4eG_-H5sX-32" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-54" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5020424200564014;exitY=0.991847240563595;entryX=0.5023715303972434;entryY=0.009238357543945313;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-32" target="nTh_WmzemqS4eG_-H5sX-33" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-55" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5023715303972434;exitY=1.000666961669922;entryX=0.49753888134885893;entryY=0.000666961669921875;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-33" target="nTh_WmzemqS4eG_-H5sX-34" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-56" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49753888134885893;exitY=0.9920955657958984;entryX=0.5000019073486328;entryY=-0.007904434204101562;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-34" target="nTh_WmzemqS4eG_-H5sX-35" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-57" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5000019073486328;exitY=0.983524169921875;entryX=0.49802526843406464;entryY=0.003524169921875;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-35" target="nTh_WmzemqS4eG_-H5sX-36" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-58" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49802526843406464;exitY=0.9949527740478515;entryX=0.5000028890721938;entryY=-0.0018555977765251609;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-36" target="nTh_WmzemqS4eG_-H5sX-37" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-59" value="是" style="curved=1;startArrow=none;endArrow=block;exitX=0.970704573327578;exitY=0.9991620288175695;entryX=0.49919631249928553;entryY=0.009149322509765625;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-37" target="nTh_WmzemqS4eG_-H5sX-38" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2654" y="2748" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-60" value="否" style="curved=1;startArrow=none;endArrow=block;exitX=0.029301204816809614;exitY=0.9991620288175695;entryX=0.27179951245553813;entryY=0.0005779266357421875;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-37" target="nTh_WmzemqS4eG_-H5sX-39" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2462" y="2748" />
              <mxPoint x="2462" y="2857" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-61" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49919631249928553;exitY=1.0005779266357422;entryX=0.7282042295808272;entryY=0.0005779266357421875;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-38" target="nTh_WmzemqS4eG_-H5sX-39" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2654" y="2857" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-62" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5000018710181826;exitY=0.9920065307617187;entryX=0.4961862054489951;entryY=-0.00799346923828125;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-39" target="nTh_WmzemqS4eG_-H5sX-40" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-63" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4961862054489951;exitY=0.9834351348876953;entryX=0.5000024557113647;entryY=0.0034351348876953125;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-40" target="nTh_WmzemqS4eG_-H5sX-41" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nTh_WmzemqS4eG_-H5sX-64" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5000024557113647;exitY=0.9948637390136719;entryX=0.500007016318185;entryY=-0.007553324979894301;rounded=0;" parent="1" source="nTh_WmzemqS4eG_-H5sX-41" target="nTh_WmzemqS4eG_-H5sX-42" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="cxVJnBDbQgxQkROG4huE" name="StepBuilder.Layer">
    <mxGraphModel dx="1571" dy="954" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-1" value="开始 Layer 方法" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="348" y="20" width="138" height="39" as="geometry" />
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-2" value="设置追踪&#xa;tracer.Start(&#39;compute step&#39;)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="288" y="109" width="257" height="78" as="geometry" />
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-3" value="检查强制构建&#xa;step.Force == true?" style="rhombus;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="309" y="237" width="216" height="216" as="geometry" />
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-4" value="跳过缓存检查" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="20" y="843" width="156" height="54" as="geometry" />
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-5" value="通过哈希查找层&#xa;sb.index.LayerMetaFromHash(hash)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="411" y="527" width="260" height="78" as="geometry" />
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-6" value="记录日志&#xa;&#39;layer not found in cache&#39;" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="226" y="831" width="240" height="78" as="geometry" />
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-7" value="获取缓存元数据&#xa;sb.index.Cached(buildID)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="552" y="679" width="240" height="78" as="geometry" />
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-8" value="记录日志&#xa;&#39;layer not cached&#39;" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="516" y="831" width="185" height="78" as="geometry" />
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-9" value="返回当前层已缓存&#xa;LayerResult{&#xa;  Metadata: meta,&#xa;  Cached: true,&#xa;  Hash: hash&#xa;}" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="646" y="1231" width="180" height="174" as="geometry" />
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-10" value="基于源层创建新元数据&#xa;finalMetadata = sourceLayer.Metadata&#xa;finalMetadata.Template = TemplateFiles{&#xa;  BuildID: uuid.NewString(),&#xa;  KernelVersion: sourceLayer.KernelVersion,&#xa;  FirecrackerVersion: sourceLayer.FirecrackerVersion&#xa;}" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="216" y="983" width="260" height="198" as="geometry" />
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-11" value="返回当前层未缓存&#xa;LayerResult{&#xa;  Metadata: finalMetadata,&#xa;  Cached: false,&#xa;  Hash: hash&#xa;}" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="225" y="1231" width="243" height="174" as="geometry" />
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-12" value="结束" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="513" y="1455" width="57" height="39" as="geometry" />
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-13" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="Qzg3HVT-wBRl4-2wadSK-1" target="Qzg3HVT-wBRl4-2wadSK-2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-14" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="Qzg3HVT-wBRl4-2wadSK-2" target="Qzg3HVT-wBRl4-2wadSK-3">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-15" value="是" style="curved=1;startArrow=none;endArrow=block;exitX=0;exitY=0.73;entryX=0.5;entryY=0.01;rounded=0;" edge="1" parent="1" source="Qzg3HVT-wBRl4-2wadSK-3" target="Qzg3HVT-wBRl4-2wadSK-4">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="98" y="490" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-16" value="否" style="curved=1;startArrow=none;endArrow=block;exitX=0.93;exitY=1;entryX=0.5;entryY=0.01;rounded=0;" edge="1" parent="1" source="Qzg3HVT-wBRl4-2wadSK-3" target="Qzg3HVT-wBRl4-2wadSK-5">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="541" y="490" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-17" value="失败" style="curved=1;startArrow=none;endArrow=block;exitX=0.11;exitY=1.01;entryX=0.5;entryY=0.01;rounded=0;" edge="1" parent="1" source="Qzg3HVT-wBRl4-2wadSK-5" target="Qzg3HVT-wBRl4-2wadSK-6">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="346" y="642" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-18" value="成功" style="curved=1;startArrow=none;endArrow=block;exitX=0.76;exitY=1.01;entryX=0.5;entryY=0.01;rounded=0;" edge="1" parent="1" source="Qzg3HVT-wBRl4-2wadSK-5" target="Qzg3HVT-wBRl4-2wadSK-7">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="672" y="642" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-19" value="失败" style="curved=1;startArrow=none;endArrow=block;exitX=0.36;exitY=1.01;entryX=0.5;entryY=0.01;rounded=0;" edge="1" parent="1" source="Qzg3HVT-wBRl4-2wadSK-7" target="Qzg3HVT-wBRl4-2wadSK-8">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="608" y="794" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-20" value="成功" style="curved=1;startArrow=none;endArrow=block;exitX=0.64;exitY=1.01;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="Qzg3HVT-wBRl4-2wadSK-7" target="Qzg3HVT-wBRl4-2wadSK-9">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="736" y="794" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-21" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1.01;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="Qzg3HVT-wBRl4-2wadSK-6" target="Qzg3HVT-wBRl4-2wadSK-10">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-22" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1.01;entryX=1;entryY=0.16;rounded=0;" edge="1" parent="1" source="Qzg3HVT-wBRl4-2wadSK-8" target="Qzg3HVT-wBRl4-2wadSK-10">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="608" y="946" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-23" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1.01;entryX=0;entryY=0.14;rounded=0;" edge="1" parent="1" source="Qzg3HVT-wBRl4-2wadSK-4" target="Qzg3HVT-wBRl4-2wadSK-10">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="98" y="946" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-24" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="Qzg3HVT-wBRl4-2wadSK-10" target="Qzg3HVT-wBRl4-2wadSK-11">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-25" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.99;entryY=0.34;rounded=0;" edge="1" parent="1" source="Qzg3HVT-wBRl4-2wadSK-9" target="Qzg3HVT-wBRl4-2wadSK-12">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="736" y="1430" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Qzg3HVT-wBRl4-2wadSK-26" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=-0.01;entryY=0.34;rounded=0;" edge="1" parent="1" source="Qzg3HVT-wBRl4-2wadSK-11" target="Qzg3HVT-wBRl4-2wadSK-12">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="346" y="1430" />
            </Array>
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="kmTGZt_N8BzOqGan6cGm" name="StepBuilder.Build">
    <mxGraphModel dx="2310" dy="901" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="0biThvozJVhlLsOMc4cD-14" value="开始 StepBuilder.Build" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="115" y="450" width="183" height="34" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-15" value="设置追踪&#xa;tracer.Start(&#39;build step&#39;)" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="114" y="534" width="186" height="50" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-16" value="获取步骤配置&#xa;step := sb.step" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="146" y="633" width="122" height="50" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-17" value="创建沙箱配置&#xa;sbxConfig := sandbox.Config{&#xa;Vcpu, RamMB, HugePages,&#xa;Envd.Version}" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="95" y="733" width="223" height="82" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-18" value="检查源层(上一层)是否是缓存的&#xa;sourceLayer.Cached?" style="rhombus;strokeWidth=2;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="100" y="864" width="212" height="212" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-19" value="创建新沙箱策略&#xa;sandboxCreator =&#xa;layer.NewCreateSandbox()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="-25" y="1145" width="205" height="66" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-20" value="恢复沙箱策略&#xa;sandboxCreator =&#xa;layer.NewResumeSandbox()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="230" y="1145" width="211" height="66" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-21" value="创建动作执行器&#xa;actionExecutor =&#xa;layer.NewFunctionAction()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="104" y="1261" width="205" height="66" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-22" value="动作执行器函数" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="-85" y="1376" width="136" height="34" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-23" value="执行命令&#xa;sb.commandExecutor.Execute()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="-137" y="1468" width="241" height="50" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-24" value="返回错误&#xa;NewPhaseBuildError()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="-427" y="1872" width="170" height="50" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-25" value="同步变更到磁盘&#xa;sandboxtools.SyncChangesToDisk()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="-24" y="1658" width="261" height="50" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-26" value="返回错误&#xa;&#39;error running sync command&#39;" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="-207" y="1872" width="224" height="50" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-27" value="更新上下文&#xa;meta.Context = cmdMeta" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="67" y="1872" width="197" height="50" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-28" value="返回元数据&#xa;return meta, nil" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="101" y="2004" width="130" height="50" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-29" value="创建模板提供者&#xa;templateProvider =&#xa;NewCacheSourceTemplateProvider()" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="436" y="1460" width="274" height="66" as="geometry" />
        </mxCell>
        <UserObject label="执行层构建&#xa;sb.layerExecutor.BuildLayer(&#xa;LayerBuildCommand{&#xa;  SourceTemplate,&#xa;  CurrentLayer,&#xa;  Hash,&#xa;  UpdateEnvd,&#xa;  SandboxCreator,&#xa;  ActionExecutor&#xa;})" link="data:page/id,wNZgj8RMV-2R5AmFV6Rv" id="0biThvozJVhlLsOMc4cD-31">
          <mxCell style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
            <mxGeometry x="463" y="1600" width="221" height="160" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="0biThvozJVhlLsOMc4cD-32" value="返回错误&#xa;&#39;error building step&#39;" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="314" y="1872" width="153" height="50" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-33" value="返回层结果&#xa;LayerResult{&#xa;  Metadata: meta,&#xa;  Cached: false,&#xa;  Hash: currentLayer.Hash&#xa;}" style="whiteSpace=wrap;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="518" y="1840" width="190" height="114" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-34" value="结束" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="363" y="2012" width="56" height="34" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-35" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5008454505211669;exitY=0.9873950060676125;entryX=0.4981436421794276;entryY=-0.008571395874023438;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-14" target="0biThvozJVhlLsOMc4cD-15" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-36" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4981436421794276;exitY=0.9828572082519531;entryX=0.4971698151260126;entryY=0.002857208251953125;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-15" target="0biThvozJVhlLsOMc4cD-16" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-37" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4971698151260126;exitY=0.9942858123779297;entryX=0.5006938002034688;entryY=-0.0034842607451648247;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-16" target="0biThvozJVhlLsOMc4cD-17" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-38" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5006938002034688;exitY=0.9912893248767387;entryX=0.5030882898366676;entryY=0.0013477577353423497;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-17" target="0biThvozJVhlLsOMc4cD-18" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-39" value="是" style="curved=1;startArrow=none;endArrow=block;exitX=0.04339866022584393;exitY=1.003439579369887;entryX=0.5011938560299757;entryY=0.004554864132043087;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-18" target="0biThvozJVhlLsOMc4cD-19" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="78" y="1111" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-40" value="否" style="curved=1;startArrow=none;endArrow=block;exitX=0.9627779194474912;exitY=1.003439579369887;entryX=0.5003066085526163;entryY=0.004554864132043087;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-18" target="0biThvozJVhlLsOMc4cD-20" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="336" y="1111" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-41" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5011938560299757;exitY=0.9980613246108546;entryX=0.14397773728490215;entryY=-0.0019386753891453598;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-19" target="0biThvozJVhlLsOMc4cD-21" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="78" y="1236" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-42" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5003066085526163;exitY=0.9980613246108546;entryX=0.857531701206547;entryY=-0.0019386753891453598;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-20" target="0biThvozJVhlLsOMc4cD-21" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="336" y="1236" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-43" value="" style="curved=1;dashed=1;dashPattern=2 3;startArrow=none;endArrow=block;exitX=0.0010632073006978848;exitY=0.896374023501859;entryX=0.5022536235697129;entryY=0.01304334752699908;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-21" target="0biThvozJVhlLsOMc4cD-22" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-17" y="1351" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-44" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5022536235697129;exitY=1.0004383535946118;entryX=0.49919706558290855;entryY=0.00029804229736328123;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-22" target="0biThvozJVhlLsOMc4cD-23" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-45" value="失败" style="curved=1;startArrow=none;endArrow=block;exitX=0.000290709159220667;exitY=0.9917266464233399;entryX=0.49964990054859837;entryY=0.006012763977050781;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-23" target="0biThvozJVhlLsOMc4cD-24" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-342" y="1560" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-46" value="成功" style="curved=1;startArrow=none;endArrow=block;exitX=0.6886863066610677;exitY=0.9917266464233399;entryX=0.5014693782704086;entryY=0.0031553268432617187;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-23" target="0biThvozJVhlLsOMc4cD-25" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="107" y="1560" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-47" value="失败" style="curved=1;startArrow=none;endArrow=block;exitX=0.3457648814904392;exitY=0.9945839309692383;entryX=0.5004219327654157;entryY=0.006012763977050781;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-25" target="0biThvozJVhlLsOMc4cD-26" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-95" y="1806" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-48" value="成功" style="curved=1;startArrow=none;endArrow=block;exitX=0.546894281698523;exitY=0.9945839309692383;entryX=0.5012842943220575;entryY=0.006012763977050781;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-25" target="0biThvozJVhlLsOMc4cD-27" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="166" y="1806" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-49" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5012842943220575;exitY=0.9974413681030273;entryX=0.4981000460111178;entryY=-0.0025585174560546877;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-27" target="0biThvozJVhlLsOMc4cD-28" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-50" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1.0004462311907512;exitY=0.73955364693924;entryX=0.5004262332498592;entryY=0.00022581851843631628;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-21" target="0biThvozJVhlLsOMc4cD-29" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="573" y="1351" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-51" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5004262332498592;exitY=0.9937322789972479;entryX=0.49826600864462184;entryY=0.0008862956186358849;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-29" target="0biThvozJVhlLsOMc4cD-31" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-52" value="失败" style="curved=1;startArrow=none;endArrow=block;exitX=-0.0011044454790348382;exitY=0.9183600442733596;entryX=0.5023831635518791;entryY=0.006012763977050781;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-31" target="0biThvozJVhlLsOMc4cD-32" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="391" y="1806" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-53" value="成功" style="curved=1;startArrow=none;endArrow=block;exitX=0.6266606748861857;exitY=0.9984786644410552;entryX=0.4971023961117393;entryY=0.002637126989531935;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-31" target="0biThvozJVhlLsOMc4cD-33" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="612" y="1806" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-54" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.4971023961117393;exitY=0.9988778432210287;entryX=0.9938198157719204;entryY=0.306296709153872;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-33" target="0biThvozJVhlLsOMc4cD-34" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="612" y="1979" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-55" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.49964990054859837;exitY=0.9974413681030273;entryX=0.001345327922276088;entryY=0.434415650876892;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-24" target="0biThvozJVhlLsOMc4cD-34" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-342" y="1979" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-56" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5004219327654157;exitY=0.9974413681030273;entryX=0.001345327922276088;entryY=0.40616808075612076;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-26" target="0biThvozJVhlLsOMc4cD-34" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-95" y="1979" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-57" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5023831635518791;exitY=0.9974413681030273;entryX=0.4975825718470982;entryY=-0.0037625256706686583;rounded=0;" parent="1" source="0biThvozJVhlLsOMc4cD-32" target="0biThvozJVhlLsOMc4cD-34" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-58" value="&lt;span class=&quot;markdown-bold-text&quot; style=&quot;color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; font-weight: 600;&quot;&gt;&lt;span&gt;这里的&lt;span&gt;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;markdown-inline-code leading-[1.4]&quot; style=&quot;line-height: 1.4; background-color: rgba(220, 220, 220, 0.4); border-radius: 4px; color: rgb(0, 106, 177); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.9em; padding: 1.5px 3px; transition: 0.1s; border-color: rgb(0, 106, 177); word-break: break-all; cursor: pointer;&quot;&gt;&lt;span&gt;sourceLayer.Cached&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;&amp;nbsp;&lt;/span&gt;指的是&quot;上一层&quot;是否来自缓存&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;，而不是&quot;当前层&quot;&lt;br&gt;上一层来自缓存：&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;说明还没创建过沙箱，要新创建&lt;br&gt;上一层不来自缓存：上一层创建了沙箱，恢复之前创建过的沙箱，继续使用即可&lt;br&gt;&lt;/span&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="419" y="1030" width="480" height="40" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-59" value="五种命令执行位置：&#xa;packages\orchestrator\internal\template\build\commands" style="text;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-530" y="1400" width="330" height="40" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-60" value="&lt;span class=&quot;markdown-inline-code leading-[1.4]&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; line-height: 1.4; background-color: color(srgb 0.747556 0.747556 0.747556 / 0.420392); border-radius: 4px; color: inherit; font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.9em; padding: 1.5px 3px; transition: all 0.1s ease 0s; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; word-break: break-all; cursor: default;&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;run.go&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;、&lt;/span&gt;&lt;span class=&quot;markdown-inline-code leading-[1.4]&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; line-height: 1.4; background-color: color(srgb 0.747556 0.747556 0.747556 / 0.420392); border-radius: 4px; color: inherit; font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.9em; padding: 1.5px 3px; transition: all 0.1s ease 0s; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; word-break: break-all; cursor: default;&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;copy.&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;go&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;、&lt;/span&gt;&lt;span class=&quot;markdown-inline-code leading-[1.4]&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; line-height: 1.4; background-color: color(srgb 0.747556 0.747556 0.747556 / 0.420392); border-radius: 4px; color: inherit; font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.9em; padding: 1.5px 3px; transition: all 0.1s ease 0s; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; word-break: break-all; cursor: default;&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;user.go&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;、&lt;/span&gt;&lt;span class=&quot;markdown-inline-code leading-[1.4]&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; line-height: 1.4; background-color: color(srgb 0.747556 0.747556 0.747556 / 0.420392); border-radius: 4px; color: inherit; font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.9em; padding: 1.5px 3px; transition: all 0.1s ease 0s; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; word-break: break-all; cursor: default;&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;workdir.go&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;&quot;&gt;、&lt;/span&gt;&lt;span class=&quot;markdown-inline-code leading-[1.4]&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; line-height: 1.4; background-color: color(srgb 0.747556 0.747556 0.747556 / 0.420392); border-radius: 4px; color: inherit; font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace, Menlo, Monaco, &amp;quot;Courier New&amp;quot;, monospace; font-size: 0.9em; padding: 1.5px 3px; transition: all 0.1s ease 0s; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; word-break: break-all; cursor: default;&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;env.go&lt;br&gt;&lt;br&gt;user.go是orchestrator在user层用的&lt;br&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; background-color: rgb(242, 242, 242);&quot;&gt;它的命令&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; background-color: rgb(242, 242, 242); font-weight: 600;&quot; class=&quot;markdown-bold-text&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;不是用&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;户在模板定&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;义中&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;写&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;的&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; background-color: rgb(242, 242, 242);&quot;&gt;，而是&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; background-color: rgb(242, 242, 242); font-weight: 600;&quot; class=&quot;markdown-bold-text&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;orchest&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;rator 在执行构建时自动插&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;入的&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; background-color: rgb(242, 242, 242);&quot;&gt;。&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-560" y="1473" width="330" height="40" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-61" value="&lt;span style=&quot;background-color: rgb(242, 242, 242); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px;&quot;&gt;Linux&lt;/span&gt;&lt;span style=&quot;background-color: rgb(242, 242, 242); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;&amp;nbsp;为&lt;/span&gt;&lt;span style=&quot;background-color: rgb(242, 242, 242); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;了性&lt;/span&gt;&lt;span style=&quot;background-color: rgb(242, 242, 242); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;能&lt;/span&gt;&lt;span style=&quot;background-color: rgb(242, 242, 242); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;，会将写&lt;/span&gt;&lt;span style=&quot;background-color: rgb(242, 242, 242); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;操&lt;/span&gt;&lt;span style=&quot;background-color: rgb(242, 242, 242); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;作缓存&lt;/span&gt;&lt;span style=&quot;background-color: rgb(242, 242, 242); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;在内存中（页面&lt;/span&gt;&lt;span style=&quot;background-color: rgb(242, 242, 242); color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;缓存）&lt;br&gt;&lt;/span&gt;执行sync命令来强制将内存缓冲区的数据写入磁盘" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="140" y="1600" width="320" height="70" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-62" value="&lt;div style=&quot;color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #4b69c6;&quot;&gt;type&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;font-weight: bold;&quot;&gt;Context&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #4b69c6;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #333333;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;User&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;string&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;`&lt;/span&gt;&lt;span style=&quot;color: #448c27;&quot;&gt;json:&quot;user,omitempty&quot;&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;`&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #333333;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;WorkDir&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;string&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;`&lt;/span&gt;&lt;span style=&quot;color: #448c27;&quot;&gt;json:&quot;workdir,omitempty&quot;&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;`&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #333333;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;EnvVars&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #4b69c6;&quot;&gt;map&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;string&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;string&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;`&lt;/span&gt;&lt;span style=&quot;color: #448c27;&quot;&gt;json:&quot;env_vars,omitempty&quot;&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;`&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #777777;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-137" y="2070" width="470" height="120" as="geometry" />
        </mxCell>
        <mxCell id="0biThvozJVhlLsOMc4cD-63" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.249;entryY=0.083;entryDx=0;entryDy=0;entryPerimeter=0;shape=flexArrow;" parent="1" source="0biThvozJVhlLsOMc4cD-27" target="0biThvozJVhlLsOMc4cD-62" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="ixt1B0D9xi53rm6hGKQD" name="UserBuilder">
    <mxGraphModel dx="726" dy="544" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="IIqD3NKquyBRmRdrhy8e-1" value="// 检查用户是否存在&#xa;id -u user&#xa;&#xa;// 创建用户（如果不存在）&#xa;adduser --disabled-password --gecos &quot;&quot; user&#xa;&#xa;// 添加到 sudo 组&#xa;usermod -aG sudo user&#xa;&#xa;// 移除密码（允许无密码登录）&#xa;passwd -d user&#xa;&#xa;// 配置 sudoers（允许无密码 sudo）&#xa;grep -q &#39;^user ALL=(ALL:ALL) NOPASSWD: ALL&#39; /etc/sudoers || echo &#39;user ALL=(ALL:ALL) NOPASSWD: ALL&#39; &gt;&gt;/etc/sudoers&#xa;&#xa;// 验证用户名&#xa;printf &quot;user&quot;" style="text;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="350" y="210" width="560" height="210" as="geometry" />
        </mxCell>
        <mxCell id="IIqD3NKquyBRmRdrhy8e-2" value="UserBuilder这个阶段在模板里没法定义，是orchestrator构建过程自动插入的，它的命令也不是用户可定义；命令位置：&#xa;packages\orchestrator\internal\template\build\commands\user.go" style="text;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="350" y="140" width="380" height="40" as="geometry" />
        </mxCell>
        <mxCell id="aQFDG7aNDuK4wvp4839c-1" value="&lt;div style=&quot;color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #4b69c6;&quot;&gt;type&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;font-weight: bold;&quot;&gt;UserBuilder&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #4b69c6;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #333333;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;font-weight: bold;&quot;&gt;steps&lt;/span&gt;&lt;span style=&quot;color: #777777;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;font-weight: bold;&quot;&gt;StepBuilder&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;span style=&quot;color: #333333;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;user&lt;/span&gt;&lt;span style=&quot;color: #333333;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #7a3e9d;&quot;&gt;string&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #777777;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="350" y="20" width="230" height="120" as="geometry" />
        </mxCell>
        <mxCell id="aQFDG7aNDuK4wvp4839c-2" value="复用了StepBuilder" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="580" y="50" width="60" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="WBOh7xM72B447zihTz8G" name="PostProcessingBuilder.Build">
    <mxGraphModel dx="1335" dy="811" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="7W1x91I6-ao-12X3J9EL-1" value="开始 Build 方法&#xa;最终处理阶段" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="216" y="20" width="140" height="63" as="geometry" />
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-2" value="设置追踪&#xa;tracer.Start(&#39;build final&#39;)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="170" y="133" width="232" height="78" as="geometry" />
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-3" value="获取默认配置&#xa;defaultUser = currentLayer.Context.User&#xa;defaultWorkdir = currentLayer.Context.WorkDir" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="156" y="261" width="260" height="102" as="geometry" />
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-4" value="检查版本&#xa;IsGTEVersion(V2ReleaseVersion)" style="rhombus;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="147" y="413" width="278" height="278" as="geometry" />
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-5" value="设置旧版本默认值&#xa;defaultUser = &#39;user&#39;&#xa;defaultWorkdir = nil" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="263" y="765" width="203" height="102" as="geometry" />
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-6" value="创建沙箱配置&#xa;sbxConfig = Config{&#xa;  Vcpu, RamMB, HugePages,&#xa;  Envd{&#xa;    Version,&#xa;    DefaultUser,&#xa;    DefaultWorkdir&#xa;  }&#xa;}" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="161" y="917" width="249" height="246" as="geometry" />
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-7" value="创建沙箱创建器&#xa;layer.NewCreateSandbox(&#xa;  sbxConfig,&#xa;  sandboxFactory,&#xa;  finalizeTimeout,&#xa;  FirecrackerVersions&#xa;)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="164" y="1213" width="244" height="198" as="geometry" />
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-8" value="创建动作执行器&#xa;layer.NewFunctionAction(&#xa;  ppb.postProcessingFn(userLogger)&#xa;)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="156" y="1461" width="260" height="126" as="geometry" />
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-9" value="创建模板提供者&#xa;layer.NewCacheSourceTemplateProvider(&#xa;  sourceLayer.Metadata.Template&#xa;)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="156" y="1637" width="260" height="126" as="geometry" />
        </mxCell>
        <UserObject label="执行层构建&#xa;ppb.layerExecutor.BuildLayer(&#xa;  LayerBuildCommand{&#xa;    SourceTemplate,&#xa;    CurrentLayer,&#xa;    Hash,&#xa;    UpdateEnvd: sourceLayer.Cached,&#xa;    SandboxCreator,&#xa;    ActionExecutor&#xa;  })" link="data:page/id,wNZgj8RMV-2R5AmFV6Rv" id="7W1x91I6-ao-12X3J9EL-10">
          <mxCell style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
            <mxGeometry x="156" y="1813" width="260" height="270" as="geometry" />
          </mxCell>
        </UserObject>
        <mxCell id="7W1x91I6-ao-12X3J9EL-11" value="返回错误&#xa;&#39;error running start and ready&#xa;commands in sandbox&#39;" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="305" y="2193" width="260" height="102" as="geometry" />
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-12" value="返回结果&#xa;LayerResult{&#xa;  Metadata: finalLayer,&#xa;  Cached: false,&#xa;  Hash: currentLayer.Hash&#xa;}" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="20" y="2157" width="235" height="174" as="geometry" />
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-13" value="结束" style="rounded=1;whiteSpace=wrap;arcSize=50;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="258" y="2381" width="57" height="39" as="geometry" />
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-14" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="7W1x91I6-ao-12X3J9EL-1" target="7W1x91I6-ao-12X3J9EL-2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-15" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="7W1x91I6-ao-12X3J9EL-2" target="7W1x91I6-ao-12X3J9EL-3">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-16" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="7W1x91I6-ao-12X3J9EL-3" target="7W1x91I6-ao-12X3J9EL-4">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-17" value="&lt;V2" style="curved=1;startArrow=none;endArrow=block;exitX=0.72;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="7W1x91I6-ao-12X3J9EL-4" target="7W1x91I6-ao-12X3J9EL-5">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="364" y="728" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-18" value="&gt;= V2" style="curved=1;startArrow=none;endArrow=block;exitX=0.28;exitY=1;entryX=0.24;entryY=0;rounded=0;" edge="1" parent="1" source="7W1x91I6-ao-12X3J9EL-4" target="7W1x91I6-ao-12X3J9EL-6">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="208" y="728" />
              <mxPoint x="208" y="892" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-19" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.76;entryY=0;rounded=0;" edge="1" parent="1" source="7W1x91I6-ao-12X3J9EL-5" target="7W1x91I6-ao-12X3J9EL-6">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="364" y="892" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-20" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="7W1x91I6-ao-12X3J9EL-6" target="7W1x91I6-ao-12X3J9EL-7">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-21" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="7W1x91I6-ao-12X3J9EL-7" target="7W1x91I6-ao-12X3J9EL-8">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-22" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="7W1x91I6-ao-12X3J9EL-8" target="7W1x91I6-ao-12X3J9EL-9">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-23" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="7W1x91I6-ao-12X3J9EL-9" target="7W1x91I6-ao-12X3J9EL-10">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-24" value="失败" style="curved=1;startArrow=none;endArrow=block;exitX=0.95;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="7W1x91I6-ao-12X3J9EL-10" target="7W1x91I6-ao-12X3J9EL-11">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="435" y="2120" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-25" value="成功" style="curved=1;startArrow=none;endArrow=block;exitX=0.05;exitY=1;entryX=0.5;entryY=0;rounded=0;" edge="1" parent="1" source="7W1x91I6-ao-12X3J9EL-10" target="7W1x91I6-ao-12X3J9EL-12">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="137" y="2120" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-26" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0;entryY=0.28;rounded=0;" edge="1" parent="1" source="7W1x91I6-ao-12X3J9EL-12" target="7W1x91I6-ao-12X3J9EL-13">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="137" y="2356" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="7W1x91I6-ao-12X3J9EL-27" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.5;exitY=1;entryX=0.99;entryY=0.28;rounded=0;" edge="1" parent="1" source="7W1x91I6-ao-12X3J9EL-11" target="7W1x91I6-ao-12X3J9EL-13">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="435" y="2356" />
            </Array>
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="wNZgj8RMV-2R5AmFV6Rv" name="LayerExecutor.BuildLayer">
    <mxGraphModel dx="1335" dy="811" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="okiLErDui9nkct7DslzN-14" value="&lt;ul style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; margin: 0px 0px 0px 16px; color: rgb(51, 51, 51); font-family: &amp;quot;Segoe WPC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(242, 242, 242); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; padding: 0px;&quot;&gt;&lt;li data-indent=&quot;0&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; margin-bottom: 2px !important; margin-top: 2px !important; margin-left: 0px; padding-top: 2px; padding-bottom: 2px; list-style-type: disc;&quot;&gt;&lt;span class=&quot;markdown-bold-text&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; font-weight: 600;&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;Orchest&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;rator&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;&lt;span&gt;&amp;nbsp;&lt;/span&gt;→&lt;span&gt;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;markdown-bold-text&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; font-weight: 600;&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;Proxy&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;（根据请求找sbx&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;）&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;&lt;span&gt;&amp;nbsp;&lt;/span&gt;→&lt;span&gt;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;markdown-bold-text&quot; style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; font-weight: 600;&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;env&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;d&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;（在&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;&lt;span&gt;&amp;nbsp;&lt;/span&gt;VM 内&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;）&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;&lt;span&gt;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;→&amp;nbsp;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in; font-weight: 600;&quot; class=&quot;markdown-bold-text&quot;&gt;&lt;span style=&quot;animation: 0.25s ease 0s 1 normal none running fade-in;&quot;&gt;执行命令&lt;/span&gt;&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="544" y="770" width="466" height="50" as="geometry" />
        </mxCell>
        <mxCell id="okiLErDui9nkct7DslzN-3" value="获取上一层模板快照&#xa;cmd.SourceTemplate.Get()" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="260.25" y="330" width="200" height="66" as="geometry" />
        </mxCell>
        <mxCell id="okiLErDui9nkct7DslzN-4" value="根据creator恢复/创建沙箱&#xa;sbx, err := cmd.SandboxCreator.Sandbox()" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="220" y="438" width="280.5" height="66" as="geometry" />
        </mxCell>
        <mxCell id="okiLErDui9nkct7DslzN-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="okiLErDui9nkct7DslzN-3" target="okiLErDui9nkct7DslzN-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="okiLErDui9nkct7DslzN-6" value="上一步的沙箱注册到proxy，让proxy能找到他&#xa;lb.sandboxes.Insert(sbx)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="220" y="534" width="280.5" height="66" as="geometry" />
        </mxCell>
        <mxCell id="okiLErDui9nkct7DslzN-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="okiLErDui9nkct7DslzN-4" target="okiLErDui9nkct7DslzN-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="okiLErDui9nkct7DslzN-8" value="更新envd&#xa;if cmd.UpdateEnvd {    err = lb.updateEnvdInSandbox(ctx, userLogger, sbx)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="220" y="632" width="280.5" height="66" as="geometry" />
        </mxCell>
        <mxCell id="okiLErDui9nkct7DslzN-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="okiLErDui9nkct7DslzN-6" target="okiLErDui9nkct7DslzN-8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="okiLErDui9nkct7DslzN-10" value="执行构建&#xa;cmd.ActionExecutor.Execute()" style="whiteSpace=wrap;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="260.5" y="740" width="200" height="66" as="geometry" />
        </mxCell>
        <mxCell id="okiLErDui9nkct7DslzN-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="okiLErDui9nkct7DslzN-8" target="okiLErDui9nkct7DslzN-10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="okiLErDui9nkct7DslzN-12" value="暂停沙箱上传快照&#xa;lb.PauseAndUpload()" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="260.5" y="860" width="200" height="66" as="geometry" />
        </mxCell>
        <mxCell id="okiLErDui9nkct7DslzN-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="okiLErDui9nkct7DslzN-10" target="okiLErDui9nkct7DslzN-12">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
