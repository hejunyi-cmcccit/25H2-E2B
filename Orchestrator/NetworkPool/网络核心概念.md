# 网络知识补充与方法解释

## 🔑 核心网络概念

### 1. 网络命名空间 (Network Namespace)

- Linux 的一种隔离机制，可以创建独立的网络环境
- 每个命名空间有自己的网络接口、路由表、防火墙规则等
- 就像给程序创建了一个"虚拟的独立网络世界"

### 2. Veth 对 (Virtual Ethernet Pair)

- 一对虚拟网络接口，像一根"虚拟网线"的两端
- 从一端发送的数据会从另一端接收
- 常用于连接不同的网络命名空间

### 3. TAP 设备

- 虚拟网络设备，工作在数据链路层
- Firecracker 虚拟机需要一个"网卡"来收发数据
- TAP 设备就是这个虚拟网卡
- Firecracker 通过 TAP 设备读写网络包，就像操作真实网卡一样
- 宿主机程序可以拦截、转发这些数据包

**为什么需要 TAP？**

- 虚拟机不能直接用物理网卡（会冲突）
- 需要一个"接口"让虚拟机以为自己有网卡
- 宿主机可以控制虚拟机的网络流量
- Firecracker 是用户态进程，它不能直接操作内核的 vpeer 设备。TAP 设备提供了一个文件描述符（`/dev/net/tun`），让 Firecracker 可以：
  - **读取**：从 TAP 读取要发送给 VM 的数据包
  - **写入**：把 VM 发出的数据包写入 TAP

**技术对比：**

```
真实世界                     虚拟世界
┌─────────────┐            ┌─────────────┐
│  物理网卡    │            │  TAP 设备   │
│  (eth0)     │            │  (虚拟网卡)  │
└─────────────┘            └─────────────┘
       ↕                          ↕
  真实的网线              内存中的数据传递
       ↕                          ↕
   互联网                   宿主机程序
```

**代码示例：**

```go
tap := &netlink.Tuntap{
    Mode:      netlink.TUNTAP_MODE_TAP,
    LinkAttrs: tapAttrs,
}
```

### 4. NAT (Network Address Translation)

- 网络地址转换，用于在不同网络之间转发数据包
- **SNAT**：修改源地址
- **DNAT**：修改目标地址

### 5. iptables

- Linux 防火墙工具，可以配置数据包过滤和转发规则
